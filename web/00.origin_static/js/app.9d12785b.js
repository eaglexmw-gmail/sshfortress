(function(e){function t(t){for(var i,o,l=t[0],n=t[1],c=t[2],h=0,d=[];h<l.length;h++)o=l[h],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);u&&u(t);while(d.length)d.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var e,t=0;t<r.length;t++){for(var s=r[t],i=!0,l=1;l<s.length;l++){var n=s[l];0!==a[n]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=s[0]))}return e}var i={},a={app:0},r=[];function o(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=i,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(s,i,function(t){return e[t]}.bind(null,i));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],n=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=n;r.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0157":function(e,t,s){"use strict";var i=s("ad29"),a=s.n(i);a.a},"034f":function(e,t,s){"use strict";var i=s("64a9"),a=s.n(i);a.a},"142b":function(e,t,s){},"206f":function(e,t,s){"use strict";var i=s("83ed"),a=s.n(i);a.a},"287b":function(e,t,s){},"2bfa":function(e,t,s){"use strict";var i=s("74ee"),a=s.n(i);a.a},3147:function(e,t,s){},"34cf":function(e,t,s){"use strict";var i=s("3147"),a=s.n(i);a.a},3552:function(e,t,s){"use strict";var i=s("5a93"),a=s.n(i);a.a},3955:function(e,t,s){"use strict";var i=s("142b"),a=s.n(i);a.a},"441b":function(e,t,s){},5531:function(e,t,s){"use strict";var i=s("fe20"),a=s.n(i);a.a},"56d7":function(e,t,s){"use strict";s.r(t);var i=s("2b0e"),a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},r=[],o={name:"app"},l=o,n=(s("034f"),s("2877")),c=Object(n["a"])(l,a,r,!1,null,null,null),u=c.exports,h=s("8c4f"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("canvas",{ref:"nes",staticClass:"game",attrs:{width:"256",height:"240"},on:{click:e.toggleForm}}),s("el-form",{directives:[{name:"show",rawName:"v-show",value:e.isShowForm,expression:"isShowForm"}],ref:"form",staticClass:"demo-ruleForm login",attrs:{model:e.form}},[s("h2",[e._v("Ssh Fortress")]),s("el-form-item",{attrs:{prop:"user"}},[s("el-input",{attrs:{"prefix-icon":"el-icon-user-solid",placeholder:"username or email"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),s("el-form-item",{attrs:{prop:"input_password"}},[s("el-input",{attrs:{"prefix-icon":"el-icon-c-scale-to-original","show-password":""},model:{value:e.form.input_password,callback:function(t){e.$set(e.form,"input_password",t)},expression:"form.input_password"}})],1),s("el-form-item",{staticStyle:{display:"flex","align-content":"center","align-items":"center"},attrs:{prop:"captcha"}},[s("el-row",{attrs:{type:"flex",justify:"space-between"}},[s("el-col",{attrs:{span:16}},[s("el-input",{attrs:{placeholder:e.$t("ignoreCase")},model:{value:e.captcha_value,callback:function(t){e.captcha_value="string"===typeof t?t.trim():t},expression:"captcha_value"}})],1),s("el-col",{attrs:{span:8}},[s("el-link",{attrs:{underline:!1},on:{click:function(t){return t.stopPropagation(),e.fetchCaptcha(t)}}},[s("img",{staticStyle:{"margin-left":"18px",border:"1px solid #d7dae2","border-radius":"4px"},attrs:{src:e.captcha_img}})])],1)],1)],1),s("el-form-item",[s("div",{staticStyle:{display:"flex","justify-items":"center","justify-content":"space-between",width:"100%"}},[s("el-button",{staticStyle:{width:"30%"},attrs:{type:"primary",loading:e.loading},domProps:{textContent:e._s(e.$t("login"))},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin(t)}},nativeOn:{click:function(t){return t.preventDefault(),e.handleLogin(t)}}}),s("el-button",{staticStyle:{width:"30%"},attrs:{type:"warning",loading:e.loading},domProps:{textContent:e._s(e.$t("loginGithub"))},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin(t)}},nativeOn:{click:function(t){return t.preventDefault(),e.handleLoginGithub(t)}}}),s("el-button",{staticStyle:{width:"30%"},attrs:{type:"success"},domProps:{textContent:e._s(e.$t("anyTerm"))},on:{click:function(t){return e.$router.push({name:"anyTerm"})}}})],1)])],1)],1)},p=[],m=s("bc8f");let f,b,g,w,v=256,_=240,y=v*_,$=4096,k=$-1,S=new Float32Array($),x=new Float32Array($),C=0,P=new m["NES"]({onFrame:function(e){for(let t=0;t<y;t++)w[t]=4278190080|e[t]},onAudioSample:function(e,t){S[C]=e,x[C]=t,C=C+1&k}});function A(){window.requestAnimationFrame(A),b.data.set(g),f.putImageData(b,0,0),P.frame()}function D(e,t){let s=1;switch(t.key){case"w":e(s,m["Controller"].BUTTON_UP);break;case"s":e(s,m["Controller"].BUTTON_DOWN);break;case"a":e(s,m["Controller"].BUTTON_LEFT);break;case"d":e(s,m["Controller"].BUTTON_RIGHT);break;case"u":case"j":e(s,m["Controller"].BUTTON_B);break;case"i":case"k":e(s,m["Controller"].BUTTON_A);break;case"f":e(s,m["Controller"].BUTTON_SELECT);break;case"h":e(s,m["Controller"].BUTTON_START);break;default:break}}function z(e){P.loadROM(e),window.requestAnimationFrame(A)}var U={data(){return{isShowForm:!0,script_processor:null,audio_ctx:null,github_client_id:"",github_client_secret:"",captcha_id:"",captcha_value:"",captcha_img:"",loading:!1,form:{email:"admin@sshfortress.cn",input_password:"admin"}}},computed:{sid(){const e=new URLSearchParams(window.location.search),t=e.get("sid");return t||!1},ref(){return`${window.location.origin}${window.location.pathname}${window.location.hash}`},code(){const e=new URLSearchParams(window.location.search),t=e.get("code");return t||!1}},mounted(){this.nesStart(),this.$http.get("meta").then(e=>{e&&(this.github_client_id=e.data.github_client_id,this.github_callback_url=e.data.github_callback_url,this.fetchGithubUserLoginByCodeOrDoNothing())}),this.fetchCaptcha()},beforeDestroy(){},methods:{toggleForm(){this.isShowForm=!this.isShowForm,this.isShowForm||this.$notify({title:"Console Pad",message:this.$t("consolePad"),duration:6e3})},nesStart(){document.addEventListener("keydown",e=>{D(P.buttonDown,e)}),document.addEventListener("keyup",e=>{D(P.buttonUp,e)});let e=this.$refs.nes;f=e.getContext("2d"),b=f.getImageData(0,0,v,_),f.fillStyle="black",f.fillRect(0,0,v,_);let t=new ArrayBuffer(b.data.length);g=new Uint8ClampedArray(t),w=new Uint32Array(t);let s=new XMLHttpRequest,i=["contra","sd","smb"],a=i[Math.floor(Math.random()*i.length)],r=`/${a}.nes`;s.open("GET",r),s.overrideMimeType("text/plain; charset=x-user-defined"),s.onerror=()=>{this.$message.error("load nes file failed")},s.onload=function(){200===this.status?z(this.responseText):0===this.status||s.onerror()},s.send()},nesClose(){document.removeEventListener("keydown"),document.removeEventListener("keyup"),this.script_processor.disconnect(this.audio_ctx.destination),this.script_processor=null,this.audio_ctx.close(),this.audio_ctx=null},fetchCaptcha(){this.$http.get("captcha").then(e=>{e&&(this.captcha_id=e.data.id,this.captcha_img=e.data.image)})},fetchGithubUserLoginByCodeOrDoNothing(){if(this.code){let e={code:this.code};this.$http.get("login-github",{params:e}).then(e=>{e&&(localStorage.setItem("token",e.data.token),localStorage.setItem("expire_ts",e.data.expire_ts),localStorage.setItem("expire",e.data.expire),this.$store.commit("setUser",e.data),this.$router.push({name:"machine"}))})}},handleLogin(){this.loading=!0;let e=`login?captcha_id=${this.captcha_id}&captcha_value=${this.captcha_value}`;this.$http.post(e,this.form).then(e=>{e&&(localStorage.setItem("token",e.data.token),localStorage.setItem("expire_ts",e.data.expire_ts),localStorage.setItem("expire",e.data.expire),this.$store.commit("setUser",e.data),this.$router.push({name:"machine"})),this.loading=!1})},handleLoginGithub(){const e=`https://github.com/login/oauth/authorize?client_id=${this.github_client_id}&scope=user:email&allow_signup=true`;window.location.href=e}}},j=U,F=(s("0157"),Object(n["a"])(j,d,p,!1,null,"47664a8c",null)),T=F.exports,L=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-container",[e.isAdmin?i("comp-nav-admin"):e._e(),e.isAdmin?e._e():i("comp-nav-user"),i("el-container",{staticStyle:{height:"100vh"}},[i("el-header",[i("el-breadcrumb",{attrs:{separator:"/"}},[e.breads?e._l(e.breads,(function(t){return i("el-breadcrumb-item",{key:t,attrs:{to:{name:t}}},[e._v("\n                        "+e._s(e.$t(""+t))+"\n                    ")])})):e._e()],2),i("div",{staticClass:"header-addons"},[i("el-dropdown",[i("span",{staticStyle:{"margin-right":"2rem"},domProps:{textContent:e._s(e.language)}}),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[i("el-link",{attrs:{type:"success"},on:{click:function(t){return e.setLang("zh-CN")}}},[e._v("中文")])],1),i("el-dropdown-item",[i("el-link",{attrs:{type:"danger"},on:{click:function(t){return e.setLang("en-US")}}},[e._v("English")])],1)],1)],1),i("el-tooltip",{attrs:{content:"Help",placement:"top"}},[i("el-link",{staticClass:"addon-icon",attrs:{icon:"el-icon-question",underline:!1,target:"_blank",href:"https://fortress.mojotv.cn/01-01-what-is-fortress.html"}})],1),i("el-tooltip",{attrs:{content:e.$t("anyTerm"),placement:"top"}},[i("el-link",{staticClass:"addon-icon",attrs:{icon:"el-icon-s-promotion",underline:!1,target:"_blank"},on:{click:function(t){return e.$router.push({name:"anyTerm"})}}})],1),i("el-tooltip",{attrs:{content:e.$t("feedback"),placement:"top"}},[i("el-link",{staticClass:"addon-icon",attrs:{icon:"el-icon-s-comment",underline:!1},on:{click:e.doFeedback}})],1),i("el-dropdown",{on:{command:e.handleCommand}},[e.user?i("img",{staticStyle:{width:"40px",height:"40px",border:"1px solid #d6d6d6","border-radius":"20px"},attrs:{src:s("b640"),title:"user.email"}}):e._e(),e.user?e._e():i("i",{staticClass:"el-icon-setting"}),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"logout"},domProps:{textContent:e._s(e.$t("userLogout"))}}),i("el-dropdown-item",{attrs:{command:"updateMyself"},domProps:{textContent:e._s(e.$t("userUpdate"))}}),i("el-dropdown-item",{attrs:{command:"page"},domProps:{textContent:e._s("Source Code")}})],1)],1)],1)],1),i("el-main",{attrs:{id:"felix"}},[i("router-view")],1)],1),i("dialog-form-user",{attrs:{obj:e.user,type:"edit",visible:e.dfvMyself,id:0},on:{afterClose:e.afterUpdateMyselfDfClose}}),i("dialog-form-feedback",{attrs:{obj:null,type:"create",visible:e.dfvFeedback},on:{afterClose:function(t){e.dfvFeedback=!1}}})],1)},V=[],M=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-aside",{attrs:{width:"200"}},[s("el-menu",{attrs:{"default-openeds":["1","2","3"],router:""}},[s("el-submenu",{attrs:{index:"1"}},[s("template",{slot:"title"},[s("i",{staticClass:"el-icon-s-grid"}),e._v(e._s(e.$t("systemManage")))]),s("el-menu-item-group",[s("template",{slot:"title"},[e._v(e._s(e.$t("cluster")))]),s("el-menu-item",{attrs:{index:"/config"}},[e._v(e._s(e.$t("config")))]),s("el-menu-item",{attrs:{index:"/cluster-ssh"}},[e._v(e._s(e.$t("clusterSsh")))]),s("el-menu-item",{attrs:{index:"/cluster-jumper"}},[e._v(e._s(e.$t("clusterJumper")))]),s("el-menu-item",{attrs:{index:"/machine"}},[e._v(e._s(e.$t("machineList")))]),s("el-menu-item",{attrs:{index:"/filter-group"}},[e._v(e._s(e.$t("filterGroup")))])],2)],2),s("el-submenu",{attrs:{index:"2"}},[s("template",{slot:"title"},[s("i",{staticClass:"el-icon-user"}),e._v(e._s(e.$t("authAdmin")))]),s("el-menu-item-group",[s("template",{slot:"title"},[e._v(e._s(e.$t("userAdmin")))]),s("el-menu-item",{attrs:{index:"/user"}},[e._v(e._s(e.$t("userList")))]),s("el-menu-item",{attrs:{index:"/feedback"}},[e._v(e._s(e.$t("feedback")))])],2)],2),s("el-submenu",{attrs:{index:"3"}},[s("template",{slot:"title"},[s("i",{staticClass:"el-icon-video-camera-solid"}),e._v(e._s(e.$t("audit")))]),s("el-menu-item-group",[s("template",{slot:"title"},[e._v(e._s(e.$t("audit")))]),s("el-menu-item",{attrs:{index:"/ssh-log"},domProps:{textContent:e._s(e.$t("sshLog"))}}),s("el-menu-item",{attrs:{index:"/sftp-log"},domProps:{textContent:e._s(e.$t("sftpLog"))}}),s("el-menu-item",{attrs:{index:"/signin-log"},domProps:{textContent:e._s(e.$t("signinLog"))}})],2)],2)],1)],1)},I=[],O={name:"CompNavAdmin"},q=O,N=Object(n["a"])(q,M,I,!1,null,"8ca33294",null),E=N.exports,R=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-aside",{attrs:{width:"200"}},[s("el-menu",{attrs:{"default-openeds":["1","2"],router:""}},[s("el-submenu",{attrs:{index:"1"}},[s("template",{slot:"title"},[s("i",{staticClass:"el-icon-c-scale-to-original"}),e._v(e._s(e.$t("remoteControl")))]),s("el-menu-item-group",[s("template",{slot:"title"},[e._v("Ssh & Sftp helper")]),s("el-menu-item",{attrs:{index:"/machine"}},[e._v(e._s(e.$t("machineList")))])],2)],2),s("el-submenu",{attrs:{index:"2"}},[s("template",{slot:"title"},[s("i",{staticClass:"el-icon-film"}),e._v(e._s(e.$t("audit")))]),s("el-menu-item-group",[s("template",{slot:"title"},[e._v(e._s(e.$t("audit")))]),s("el-menu-item",{attrs:{index:"/ssh-log"},domProps:{textContent:e._s(e.$t("sshLog"))}})],2)],2)],1)],1)},B=[],H={name:"CompNavUser"},J=H,G=Object(n["a"])(J,R,B,!1,null,"76beea5c",null),W=G.exports,K=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-width":e.$store.state.dialogFormLabelWidth,rules:e.rules,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$t("userName"),prop:"name",required:""}},[s("el-input",{attrs:{autocomplete:"off",minlength:"4",maxlength:"12","show-word-limit":"",disabled:e.isView||e.form.id>0},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"===typeof t?t.trim():t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:e.$t("email"),prop:"email",required:""}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView||e.form.id>0},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email","string"===typeof t?t.trim():t)},expression:"form.email"}})],1),s("el-form-item",{attrs:{label:e.$t("realName"),prop:"real_name",required:""}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.real_name,callback:function(t){e.$set(e.form,"real_name",t)},expression:"form.real_name"}})],1),s("el-form-item",{attrs:{label:e.$t("password"),prop:"input_password"}},[s("el-input",{attrs:{type:"password","prefix-icon":"el-icon-c-scale-to-original","show-password":"",autocomplete:"off",disabled:e.isView},model:{value:e.form.input_password,callback:function(t){e.$set(e.form,"input_password","string"===typeof t?t.trim():t)},expression:"form.input_password"}})],1),s("el-form-item",{attrs:{label:e.$t("passwordR"),prop:"input_password_r"}},[s("el-input",{attrs:{type:"password","prefix-icon":"el-icon-c-scale-to-original","show-password":"",autocomplete:"off",disabled:e.isView},model:{value:e.form.input_password_r,callback:function(t){e.$set(e.form,"input_password_r","string"===typeof t?t.trim():t)},expression:"form.input_password_r"}})],1),s("el-form-item",{attrs:{label:e.$t("mobile"),prop:"mobile",required:""}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile","string"===typeof t?t.trim():t)},expression:"form.mobile"}})],1),e.isMyself?e._e():s("el-form-item",{attrs:{label:e.$t("userRole"),prop:"role",required:""}},[s("el-select",{attrs:{placeholder:e.$t("rolePlaceholder"),disabled:e.isView},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",e._n(t))},expression:"form.role"}},[s("el-option",{attrs:{label:e.$t("roleAdmin"),value:2}}),s("el-option",{attrs:{label:e.$t("roleUser"),value:4}})],1)],1),s("el-form-item",{attrs:{label:e.$t("sshFilter"),required:"",prop:"ssh_filter_group_id"}},[s("el-select",{attrs:{placeholder:e.$t("sshFilterPh"),disabled:e.isView},model:{value:e.form.ssh_filter_group_id,callback:function(t){e.$set(e.form,"ssh_filter_group_id",e._n(t))},expression:"form.ssh_filter_group_id"}},e._l(e.filterGroupList,(function(e,t){return s("el-option",{key:t,attrs:{value:e.id,label:e.name+"--"+e.remark}})})),1)],1),e.isMyself?e._e():s("el-form-item",{attrs:{label:e.$t("expiredAt"),prop:"expired_at",required:""}},[s("el-date-picker",{attrs:{disabled:e.isView,type:"datetime",placeholder:e.$t("expiredAtPlaceholder")},model:{value:e.form.expired_at,callback:function(t){e.$set(e.form,"expired_at",t)},expression:"form.expired_at"}})],1)],1),e.isView?e._e():s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){return e.$emit("afterClose")}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},Y=[],Z={name:"DialogFormUser",props:{obj:{type:Object,require:!0},type:{type:String,require:!0},visible:Boolean,id:{type:Number,require:!0}},data(){let e=(e,t,s)=>{""===t&&0===this.form.id?s(new Error("请输入密码")):(""!==this.$refs.ruleForm.input_password_r&&this.$refs.ruleForm.validateField("input_password_r"),s())},t=(e,t,s)=>{""===t&&0===this.form.id?s(new Error("请再次输入密码")):t!==this.form.input_password?s(new Error("两次输入密码不一致!")):s()};return{sshList:[],v:this.visible,isView:!1,form:this.obj,filterGroupList:[],rules:{name:[{required:!0,trigger:"blur"},{min:5,max:20,message:"长度在 5 到 20 个字符",trigger:"blur"}],input_password:[{validator:e,trigger:"change"}],input_password_r:[{validator:t,trigger:"change"}],input_ssh_password:[{type:"string",min:6,max:20,message:"长度在6到20个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确Email",trigger:"blur"}],role:[{type:"enum",enum:[2,4],trigger:"blur",required:!0}],ssh_filter_group_id:[{type:"integer",message:this.$t("sshFilterPh"),min:1,trigger:"blur",required:!0}],mobile:[{type:"string",pattern:/^1[3456789]\d{9}$/,message:"请输入有效的手机号码",trigger:"blur"}]}}},watch:{visible(e){this.v=e}},computed:{isMyself(){return this.obj.id===this.$store.getters.userId},dTitle(){if(this.isMyself)return this.$t("updateMyselfInfo");switch(this.type){case"create":return this.$t("addUserAccount");case"view":return this.$t("viewUserAccount");case"edit":return this.$t("updateUserAccount");default:return""}}},methods:{fetchSshFilterGroups(){let e={page:1,size:9999};this.$http.get("filter-group",{params:e}).then(e=>{e&&(this.filterGroupList=e.data)})},doOpen(){this.fetchSshFilterGroups(),this.form=this.obj,this.isView="view"===this.type,this.isView&&this.id>0&&this.$http.get(`user/${this.id}`).then(e=>{e&&(this.form=e.data)})},postFormData(){let e="post",t="user";"edit"===this.type&&(e="patch"),"create"===this.type&&(e="post");let s=this.form;this.$http({method:e,url:t,data:s}).then(e=>{e&&(this.isMyself&&this.$store.commit("setUser",e.data),this.$message.success("success"),this.v=!1)})},doOpened(){},handleFormSubmit(){this.$refs.ruleForm.validate(e=>{e?this.postFormData():this.$notify.error("表单错误")})}}},X=Z,Q=Object(n["a"])(X,K,Y,!1,null,"c16f7bb6",null),ee=Q.exports,te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-width":e.$store.state.dialogFormLabelWidth,rules:e.rules,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$t("feedbackPageUrl"),prop:"page"}},[s("el-input",{attrs:{autocomplete:"off",disabled:"update"===e.type},model:{value:e.form.page_url,callback:function(t){e.$set(e.form,"page_url","string"===typeof t?t.trim():t)},expression:"form.page_url"}})],1),s("el-form-item",{attrs:{label:e.$t("email"),prop:"email"}},[s("el-input",{attrs:{type:"email",autocomplete:"off",disabled:"update"===e.type},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email","string"===typeof t?t.trim():t)},expression:"form.email"}})],1),s("el-form-item",{attrs:{label:e.$t("feedbackUser"),prop:"user_name"}},[s("el-input",{attrs:{autocomplete:"off",disabled:"update"===e.type},model:{value:e.form.user_name,callback:function(t){e.$set(e.form,"user_name",t)},expression:"form.user_name"}})],1),s("el-form-item",{attrs:{label:e.$t("content"),prop:"content"}},[s("el-input",{attrs:{type:"textarea",rows:5,disabled:"update"===e.type,placeholder:"leave your valuable ideas here",autocomplete:"off"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),"update"===e.type?s("el-form-item",{attrs:{label:e.$t("feedbackStatus"),prop:"status"}},[s("el-radio-group",{on:{change:e.doChangeStatus},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.statusList,(function(t){return s("el-radio-button",{key:t,attrs:{label:t}},[e._v(e._s(e.$t("feedbackStatus"+t))+"\n                ")])})),1)],1):e._e()],1),"create"===e.type?s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){return e.$emit("afterClose")}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1):e._e()],1)},se=[],ie={name:"DialogFormFeedback",props:{visible:Boolean,obj:Object,type:String},data(){return{statusList:[0,2,4,8,16],v:this.visible,form:{page:this.$route.path},rules:{}}},watch:{visible(e){this.v=e}},computed:{dTitle(){return this.$t("feedback")}},methods:{doOpen(){switch(this.type){case"view":this.form=this.obj;break;case"create":this.form.page_url=this.$route.path,this.form.email=this.$store.getters.userEmail,this.form.user_name=this.$store.getters.userName;break;case"update":this.form=this.obj;break;default:this.$notify.error("wrong type"),this.v=!1}},doChangeStatus(){let e="patch",t="feedback",s=this.form;this.$http({method:e,url:t,data:s}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})},postFormData(){let e="post",t="feedback",s=this.form;this.$http({method:e,url:t,data:s}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})},doOpened(){switch(this.type){case"view":this.form=this.obj;break;case"create":this.form.page_url=this.$route.path,this.form.email=this.$store.getters.userEmail,this.form.user_name=this.$store.getters.userName;break;case"update":this.form=this.obj;break;default:this.$notify.error("wrong type"),this.v=!1}},handleFormSubmit(){this.$refs.ruleForm.validate(e=>{e?this.postFormData():this.$notify.error("表单错误")})}}},ae=ie,re=Object(n["a"])(ae,te,se,!1,null,"8eef96f2",null),oe=re.exports,le={components:{CompNavUser:W,CompNavAdmin:E,DialogFormUser:ee,DialogFormFeedback:oe},name:"Main",data(){return{language:this.getLanguage(),dfvFeedback:!1,dfvMyself:!1}},computed:{sid(){const e=new URLSearchParams(window.location.search),t=e.get("sid");return t||!1},code(){const e=new URLSearchParams(window.location.search),t=e.get("code");return t||!1},ref(){return`${window.location.origin}${window.location.pathname}${window.location.hash}`},userNameAndRole(){let e=this.$t(`userRole${this.user.role}`),t=this.user.real_name;return`${t}(${e})`},isAdmin(){return this.$store.getters.userIsAdmin},user(){const e={email:"fortress@mojotv.cn",name:"Fortress",role:6};let t=localStorage.getItem("user");return t&&JSON.parse(t)||e},breads(){return this.$route.meta.breads||null}},created(){let e=localStorage.getItem("language")||"en-US";this.$i18n.locale=e},mounted(){let e=this.sid;e||"/"!==this.$route.path?this.code&&(window.location.href=`/${window.location.hash}`):this.$router.push({name:"machine"})},beforeUpdate(){let e=this.$route.name;console.log(e),console.log(this.$t(e)),window.document.title=this.$t(e)},methods:{getLanguage(){let e=localStorage.getItem("language")||"en-US";return e.startsWith("zh-")?"中文":"English"},doFeedback(){this.dfvFeedback=!0},afterUpdateMyselfDfClose(){this.$forceUpdate(),this.dfvMyself=!1},setLang(e){localStorage.setItem("language",e),this.$i18n.locale=e,this.language=this.getLanguage()},handleCommand(e){"logout"===e?(localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("expire_ts"),localStorage.removeItem("expire"),this.$router.push({name:"login"})):"email"===e?window.location.href=`mailto://${this.user.name}`:"page"===e?window.location.href="https://github.com/mojocn/sshfortress":"updateMyself"===e&&(this.dfvMyself=!0)}}},ne=le,ce=(s("c266"),Object(n["a"])(ne,L,V,!1,null,null,null)),ue=ce.exports,he=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("el-row",{staticClass:"toolbar",attrs:{justify:"space-between",type:"flex",align:"middle"}},[s("el-col",{attrs:{span:6}},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"back"},expression:"{path:'back'}"}],attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}})],1),s("el-col",{attrs:{span:18}},[s("h2",[e._v(" Sftp: "+e._s(e.user)+" @ "+e._s(e.sshIp))])])],1),s("el-tree",{staticClass:"sftp-tree",attrs:{load:e.loadNode,lazy:"",indent:30,"default-expanded-keys":["/"],data:e.data,props:e.defaultProps,"node-key":"path"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,a=t.data;return s("el-row",{class:{"custom-tree-node":!0,isdir:a.is_dir},attrs:{gutter:20,justify:"center",type:"flex"}},[s("el-col",{attrs:{span:1}},[a.is_dir?s("el-link",{attrs:{icon:"el-icon-folder",type:"success"}}):e._e(),a.is_dir?e._e():s("el-link",{attrs:{icon:"el-icon-document-checked",type:"primary"}})],1),s("el-col",{attrs:{span:4}},[s("i",{staticClass:"file-name"},[e._v(e._s(i.label))])]),s("el-col",{attrs:{span:4,title:"file size (byte)"}},[s("i",{staticClass:"file-size"},[e._v(e._s(a.size))])]),s("el-col",{attrs:{span:3,title:"mod"}},[s("i",{staticClass:"file-mod"},[e._v(e._s(a.mod))])]),s("el-col",{attrs:{span:4,title:"modify time"}},[s("i",{staticClass:"file-time"},[e._v(e._s(a.time))])]),s("el-col",{attrs:{span:1}},[a.is_dir?s("el-link",{attrs:{type:"warning",title:"upload",icon:"el-icon-upload"},on:{click:function(t){return t.stopPropagation(),e.handleUploadDialog(a)}}}):e._e()],1),s("el-col",{attrs:{span:1}},[s("el-link",{attrs:{type:"success",title:"download",icon:"el-icon-download"},on:{click:function(t){return t.stopPropagation(),e.handleDownload(a)}}})],1),s("el-col",{attrs:{span:1}},[a.is_dir?e._e():s("el-link",{attrs:{type:"primary",title:"cat",icon:"el-icon-view"},on:{click:function(t){return t.stopPropagation(),e.handleSftpCat(a)}}})],1),s("el-col",{attrs:{span:1}},[1!=i.level?s("el-link",{attrs:{type:"danger",title:"rm",icon:"el-icon-delete-solid"},on:{click:function(t){return t.stopPropagation(),e.handleDelete(a)}}}):e._e()],1),s("el-col",{attrs:{span:1}},[1!=i.level?s("el-link",{attrs:{title:"rename",type:"info",icon:"el-icon-edit"},on:{click:function(t){return t.stopPropagation(),e.handleRename(a)}}}):e._e()],1),s("el-col",{attrs:{span:1}},[a.is_dir?s("el-link",{attrs:{title:"mkdir",type:"primary",icon:"el-icon-folder-add"},on:{click:function(t){return t.stopPropagation(),e.handleMkdir(a)}}}):e._e()],1)],1)}}])}),s("el-dialog",{attrs:{title:e.dUploadTitle,visible:e.uploadDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.uploadDialogVisible=t}}},[s("el-upload",{attrs:{name:"file",multiple:"","on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,action:e.uploadUrl,"file-list":e.fileList}},[s("el-button",{attrs:{size:"small",type:"primary"},domProps:{textContent:e._s(e.$t("upload"))}}),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},domProps:{textContent:e._s(e.$t("uploadTip"))},slot:"tip"})],1)],1),s("el-dialog",{attrs:{title:e.dFileViewTitle,visible:e.catDialogVisible,width:"50%",center:""},on:{"update:visible":function(t){e.catDialogVisible=t}}},[s("pre",{staticClass:"cat-view",domProps:{textContent:e._s(e.catData)}})])],1)},de=[],pe={name:"ViewSftp",props:["id","sshIp","user"],data(){return{dUploadTitle:"",dFileViewTitle:"",logData:"",uploadUrl:"",fileList:[],catDialogVisible:!1,catData:"",uploadDialogVisible:!1,logDialogV:!1,data:[{name:"$HOME",path:"~",is_dir:!0},{name:"/",path:"/",is_dir:!0}],path:"",defaultProps:{label:"name",isLeaf(e){return!e.is_dir}}}},mounted(){},created(){},methods:{loadNode(e,t){if(0===e.level)return t([{name:"$HOME",path:"$HOME",is_dir:!0},{name:"/",path:"/",is_dir:!0}]);{let s=e.data.path;this.$http.get(`sftp/${this.id}`,{params:{path:s}}).then(e=>{e&&t(e.data)})}},handleSftpCat(e){let t=e.path;this.$http.get(`sftp/${this.id}/cat`,{params:{path:t}}).then(e=>{e&&(this.catData=e.data),this.dFileViewTitle=this.$t("fileViewTitle",{path:t}),this.catDialogVisible=!0})},handleUploadSuccess(e,t){e.ok||this.$message.error(e.msg+t.name)},handleUploadError(e,t){this.$message.error(e+t.name)},handleDelete(e){let t=e.path,s=e.is_dir?"dir":"file";this.$http.get(`sftp/${this.id}/rm`,{params:{path:t,dirOrFile:s}}).then(e=>{e&&this.$message.success(t+" has been deleted!")})},handleMkdir(e){this.$prompt(e.path,"mkdir",{confirmButtonText:"OK",cancelButtonText:"Cancel",inputPlaceholder:e.path}).then(({value:t})=>{let s=`${e.path}/${t}`;this.$http.get(`sftp/${this.id}/mkdir`,{params:{path:s}}).then(e=>{e&&this.$message.success(s+" has been made!")})}).catch(()=>{this.$message({type:"info",message:"mkdir command has been canceled"})})},handleRename(e){this.$prompt(e.path,this.$t("renameOrMove"),{confirmButtonText:this.$t("OK"),cancelButtonText:this.$t("Cancel"),inputValue:e.path}).then(({value:t})=>{let s=e.path,i=t;this.$http.get(`sftp/${this.id}/rename`,{params:{opath:s,npath:i}}).then(e=>{e&&this.$message.success(s+" has been rename to "+i)})}).catch(()=>{this.$message({type:"info",message:"rename command has been canceled"})})},handleDownload(e){let t=this.$store.getters.jwt,s=e.is_dir?"dir":"file";window.open(`/api/sftp/${this.id}/dl?path=${e.path}&type=${s}&_t=${t}`,"_blank")},handleUploadDialog(e){this.dUploadTitle=this.$t("uploadTitle",e);let t=this.$store.getters.jwt;this.uploadDialogVisible=!0,this.uploadUrl=`/api/sftp/${this.id}/up?path=${e.path}&_t=${t}`}}},me=pe,fe=(s("b7e6"),Object(n["a"])(me,he,de,!1,null,"0bb0ef9e",null)),be=fe.exports,ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),e.selectedRows&&e.selectedRows.length>0?s("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.doDeleteAll}},[e._v("\n            "+e._s(e.$t("rmSelected"))+"\n        ")]):e._e(),s("div",{staticClass:"search-bar"},[s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("sshLogClientIpPhS"),clearable:""},on:{change:e.fetchAllSshLog},model:{value:e.q.client_ip,callback:function(t){e.$set(e.q,"client_ip","string"===typeof t?t.trim():t)},expression:"q.client_ip"}}),s("el-date-picker",{staticStyle:{"margin-right":"1rem"},attrs:{size:"small","value-format":"yyyy-MM-dd HH:mm:ss",type:"daterange",align:"right","unlink-panels":"","range-separator":e.$t("to"),"start-placeholder":e.$t("sshLogStartTimePhS"),"end-placeholder":e.$t("sshLogEndTimePhS"),"picker-options":e.pickerOptions},on:{change:e.fetchAllSshLog},model:{value:e.range,callback:function(t){e.range=t},expression:"range"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllSshLog}})],1)],1),s("el-table",{attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{label:e.$t("machineId")},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(t.row.machine.name)},on:{click:function(s){return e.linkMachineInfo(t.row)}}})]}}])}),s("el-table-column",{attrs:{label:e.$t("userId")},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(t.row.user.name)},on:{click:function(s){return e.linkUserInfo(t.row)}}})]}}])}),s("el-table-column",{attrs:{label:e.$t("clusterSsh"),prop:"ssh_user"}}),s("el-table-column",{attrs:{label:e.$t("clientIp"),prop:"client_ip"}}),s("el-table-column",{attrs:{label:e.$t("startedAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.started_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{label:e.$t("endAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.created_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{label:e.$t("sessionDuration"),width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(e.sessionDuration(t.row))}})]}}])}),s("el-table-column",{attrs:{label:e.$t("logLength")},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(e.countLogLineCount(t.row))}})]}}])}),s("el-table-column",{attrs:{label:e.$t("auditStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.$t("sshLogStatus"+t.row.status))+"\n            ")]}}])}),s("el-table-column",{attrs:{fixed:"right",label:e.$t("action"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[s("el-button",{attrs:{title:"view detail information",type:"primary",size:"mini"},domProps:{textContent:e._s(e.$t("btnView"))},on:{click:function(s){return e.doView(t.row)}}}),s("el-button",{attrs:{title:"delete a row",type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}})],1)]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("comp-ssh-log",{attrs:{obj:e.form,visible:e.termVisible},on:{"update:visible":function(t){e.termVisible=t},afterClose:e.doAfterClose}}),s("dialog-form-machine",{attrs:{obj:e.objMachine,type:"view",visible:e.dfvMachine,id:0},on:{afterClose:function(t){e.dfvMachine=!1}}}),s("dialog-form-user",{attrs:{obj:e.objUser,type:"view",visible:e.dfvUser,id:0},on:{afterClose:function(t){e.dfvUser=!1}}})],1)},we=[],ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.termTitle,width:"80%",center:""},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:e.doClose}},[e.sliderMax>0?s("el-slider",{attrs:{min:e.sliderMin,max:e.sliderMax,"show-input":""},on:{change:e.doSliderChange},model:{value:e.sliderV,callback:function(t){e.sliderV=t},expression:"sliderV"}}):e._e(),s("div",{ref:"terminal"}),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){e.v=!1}}}),s("el-radio-group",{on:{change:e.doChangeStatus},model:{value:e.status,callback:function(t){e.status=t},expression:"status"}},e._l(e.marks,(function(t){return s("el-radio-button",{key:t,attrs:{label:t}},[e._v(e._s(e.$t("sshLogStatus"+t)))])})),1)],1)],1)},_e=[],ye=s("59bf"),$e=s("c554"),ke=s("95db"),Se=s("6a49"),xe=(s("9368"),{props:{obj:{type:Object,require:!0},visible:Boolean},name:"CompSshLog",data(){return{sliderV:0,sliderMin:0,sliderMax:0,status:parseInt(this.obj.status),marks:[2,4,8,16,32],searchKey:"",v:this.visible,term:null,thisV:this.visible}},watch:{visible(e){this.v=e}},computed:{logText(){return this.obj.log},termTitle(){return`网页终端日志:${this.obj.started_at} - ${this.obj.created_at}`}},methods:{doLink(e,t){"click"===e.type&&window.open(t)},doClose(){this.term&&this.term.dispose(),this.$emit("afterClose")},doOpen(){let e=this.obj.t_log;if(e&&Array.isArray(e)){const t=e.length;this.sliderMax=t+1,this.sliderMin=0,this.sliderV=t+1}this.status=parseInt(this.obj.status)},doChangeStatus(){let e=this.obj.id,t=parseInt(this.status);this.$http.patch("ssh-log",{id:e,status:t}).then(e=>{e&&(this.$message.success("日志标记成功"),this.v=!1)})},doOpened(){ye["Terminal"].applyAddon($e),ye["Terminal"].applyAddon(ke),ye["Terminal"].applyAddon(Se),this.term=new ye["Terminal"]({disableStdin:!0,fontSize:18,cursorBlink:!1,cursorStyle:"bar",bellStyle:"sound"}),this.term.open(this.$refs.terminal),this.term.fit(),this.term.webLinksInit(this.doLink),this.doSliderChange()},doSliderChange(){let e=this.obj.t_log,t=this.sliderV,s=this.term;s.clear(),e&&Array.isArray(e)&&e.forEach((e,i)=>{i<=t&&s.write(e)})}}}),Ce=xe,Pe=Object(n["a"])(Ce,ve,_e,!1,null,null,null),Ae=Pe.exports,De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-width":e.$store.state.dialogFormLabelWidth,rules:e.rules,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$t("machineName"),prop:"name",required:""}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:e.$t("machineSshIp"),prop:"ssh_ip",required:""}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.ssh_ip,callback:function(t){e.$set(e.form,"ssh_ip","string"===typeof t?t.trim():t)},expression:"form.ssh_ip"}})],1),s("el-form-item",{attrs:{label:e.$t("machineCate"),required:""}},[s("el-radio-group",{attrs:{disabled:e.isView},model:{value:e.form.cate,callback:function(t){e.$set(e.form,"cate",t)},expression:"form.cate"}},[s("el-radio",{attrs:{label:2}},[e._v(e._s(e.$t("machineCateLan")))]),s("el-radio",{attrs:{label:4}},[e._v(e._s(e.$t("machineCateWan")))])],1)],1),s("el-form-item",{attrs:{label:e.$t("machineSshPort"),prop:"ssh_port",required:""}},[s("el-input",{attrs:{type:"number",autocomplete:"off",disabled:e.isView},model:{value:e.form.ssh_port,callback:function(t){e.$set(e.form,"ssh_port",e._n(t))},expression:"form.ssh_port"}})],1),s("el-form-item",{attrs:{label:e.$t("machineLanIp"),prop:"lan_ip"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.lan_ip,callback:function(t){e.$set(e.form,"lan_ip","string"===typeof t?t.trim():t)},expression:"form.lan_ip"}})],1),s("el-form-item",{attrs:{label:e.$t("machineWanIp"),prop:"wan_ip"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.wan_ip,callback:function(t){e.$set(e.form,"wan_ip","string"===typeof t?t.trim():t)},expression:"form.wan_ip"}})],1),s("el-form-item",{attrs:{label:e.$t("machineClusterSsh"),required:""}},[s("el-select",{attrs:{placeholder:e.$t("machineClusterSshPlace"),disabled:e.isView},model:{value:e.form.cluster_ssh_id,callback:function(t){e.$set(e.form,"cluster_ssh_id",e._n(t))},expression:"form.cluster_ssh_id"}},e._l(e.sshList,(function(e,t){return s("el-option",{key:t,attrs:{value:e.id,label:e.ssh_type+"--"+e.ssh_user+"--"+e.remark}})})),1)],1),s("el-form-item",{attrs:{label:e.$t("machineClusterJumper")}},[s("el-select",{attrs:{placeholder:e.$t("machineClusterJumperIdPh"),disabled:e.isView},model:{value:e.form.cluster_jumper_id,callback:function(t){e.$set(e.form,"cluster_jumper_id",e._n(t))},expression:"form.cluster_jumper_id"}},[s("el-option",{attrs:{value:0,label:e.$t("clusterJumperNone")}}),e._l(e.jumperList,(function(e,t){return s("el-option",{key:t,attrs:{value:e.id,label:e.name+"--"+e.ssh_addr+"--"+e.remark}})}))],2)],1)],1),e.isView?e._e():s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){return e.$emit("afterClose")}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},ze=[],Ue={name:"DialogFormMachine",props:{obj:{type:Object,require:!0},type:{type:String,require:!0},visible:Boolean,id:{type:Number,require:!0}},data(){return{jumperList:[],sshList:[],v:this.visible,isView:!1,form:this.obj,rules:{name:[{min:4,max:255,message:"长度在 4 到 255 个字符",trigger:"blur"}],ssh_ip:[{min:4,max:255,message:"长度在 4 到 255 个字符",trigger:"blur"}],ssh_port:[{type:"number",min:1,max:65535,message:"1~65535",trigger:"blur"}],email:[{type:"email",message:"请输入正确Email",trigger:"blur"}],mobile:[{type:"string",pattern:/^1[3456789]\d{9}$/,message:"请输入有效的手机号码",trigger:"blur"}]}}},watch:{visible(e){this.v=e}},computed:{dTitle(){switch(this.type){case"create":return this.form.ssh_port=22,this.$t("machineCreate");case"view":return this.$t("machineView");case"edit":return this.$t("machineUpdate");default:return""}}},methods:{fetchAllClusterSsh(){let e=1,t=9999,s="";this.$http.get("cluster-ssh",{params:{where:s,page:e,size:t}}).then(e=>{e&&(this.sshList=e.data)})},fetchAllClusterJumper(){let e=1,t=9999;this.$http.get("cluster-jumper",{params:{page:e,size:t}}).then(e=>{e&&(this.jumperList=e.data)})},doOpen(){this.fetchAllClusterSsh(),this.fetchAllClusterJumper(),this.form=this.obj,this.isView="view"===this.type,this.isView&&this.id>0&&this.$http.get(`machine/${this.id}`).then(e=>{e&&(this.form=e.data)})},postFormData(){let e="post",t="machine";"edit"===this.type&&(e="patch"),"create"===this.type&&(e="post");let s=this.form;delete s.cluster_ssh,delete s.cluster_jumper,s.cluster_ssh=null,this.$http({method:e,url:t,data:s}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})},doOpened(){},handleFormSubmit(){this.$refs.ruleForm.validate(e=>{e?this.postFormData():this.$notify.error("表单错误")})}}},je=Ue,Fe=Object(n["a"])(je,De,ze,!1,null,"90425a4e",null),Te=Fe.exports,Le={components:{CompSshLog:Ae,DialogFormMachine:Te,DialogFormUser:ee},name:"ViewSshLog",data(){return{selectedRows:null,pickerOptions:{shortcuts:[{text:this.$t("last1day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-1),e.$emit("pick",[s,t])}},{text:this.$t("last3day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-3),e.$emit("pick",[s,t])}},{text:this.$t("last7day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-7),e.$emit("pick",[s,t])}},{text:this.$t("last1month"),onClick(e){const t=new Date,s=new Date;s.setMonth(s.getMonth()-1),e.$emit("pick",[s,t])}}]},range:[],q:{client_ip:""},objUser:{},dfvUser:!1,objMachine:{},dfvMachine:!1,termVisible:!1,formTitle:"机器添加",total:0,page:1,size:10,tableData:[],form:{ssh_port:22,cate:2}}},computed:{user(){return this.$store.state.user},email(){return this.$store.getters.userEmail},isAdmin(){return this.$store.getters.userIsAdmin},user_id(){return parseInt(this.$route.query.user_id)||0},machine_id(){return parseInt(this.$route.query.machine_id)||0}},mounted(){this.fetchAllSshLog()},created(){},methods:{handleSelectionChange(e){this.selectedRows=e},sessionDuration(e){let t=Date.parse(e.created_at),s=Date.parse(e.started_at),i=t-s;return`${Math.round(i/1e3)}s`},countLogLineCount(e){return e.t_log.length||0},linkMachineInfo(e){this.objMachine=e.machine,this.dfvMachine=!0},linkUserInfo(e){this.objUser=e.user,this.dfvUser=!0},doCreate(){this.form={id:0,cate:2,ssh_port:22},this.formTitle=this.$t("machineAddTitle")},pageChange(e){this.page=e,this.fetchAllSshLog()},sizeChange(e){this.page=1,this.size=e,this.fetchAllSshLog()},fetchAllSshLog(){let e=this.q;2===this.range.length&&(e.from_time=this.range[0],e.to_time=this.range[1]),e.page=this.page,e.size=this.size,e.user_id=this.user_id,e.machine_id=this.machine_id,this.$http.get("ssh-log",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doDeleteAll(){if(!this.selectedRows||0===this.selectedRows.length)return;const e=[];this.selectedRows.forEach(t=>{e.push(t.id)}),this.privateRm(e)},privateRm(e){e&&Array.isArray(e)&&this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.post("ssh-log-rm",e).then(e=>{e&&(this.fetchAllSshLog(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},doDelete(e){this.privateRm([e.id])},doView(e){this.form=e,this.termVisible=!0},doAfterClose(){this.fetchAllSshLog(),this.termVisible=!1}}},Ve=Le,Me=Object(n["a"])(Ve,ge,we,!1,null,"ce44fc9a",null),Ie=Me.exports,Oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),s("el-button",{attrs:{type:"success",size:"small",title:"create a user"},on:{click:function(t){return e.openDialogForm({id:0},"create")}}},[e._v("\n            "+e._s(e.$t("btnAdd"))+"\n        ")]),s("div",{staticClass:"search-bar"},[s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("userNamePhS"),clearable:""},on:{blur:e.fetchAllUser},model:{value:e.q.name,callback:function(t){e.$set(e.q,"name","string"===typeof t?t.trim():t)},expression:"q.name"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("userEmailPhS"),clearable:""},on:{blur:e.fetchAllUser},model:{value:e.q.email,callback:function(t){e.$set(e.q,"email","string"===typeof t?t.trim():t)},expression:"q.email"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("userRealNamePhS"),clearable:""},on:{blur:e.fetchAllUser},model:{value:e.q.real_name,callback:function(t){e.$set(e.q,"real_name",t)},expression:"q.real_name"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("userMobilePhS"),clearable:""},on:{blur:e.fetchAllUser},model:{value:e.q.mobile,callback:function(t){e.$set(e.q,"mobile","string"===typeof t?t.trim():t)},expression:"q.mobile"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllUser}})],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"}},[s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{prop:"name",label:e.$t("userName")}}),s("el-table-column",{attrs:{prop:"real_name",label:e.$t("realName")}}),s("el-table-column",{attrs:{prop:"ancestor_path",label:e.$t("userAncestorPath")}}),s("el-table-column",{attrs:{label:e.$t("userRole")},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(e.parseRoleName(t.row))}})]}}])}),s("el-table-column",{attrs:{prop:"ssh_password",label:e.$t("sshPassword")}}),s("el-table-column",{attrs:{prop:"email",label:e.$t("email"),width:"140"}}),s("el-table-column",{attrs:{prop:"mobile",label:e.$t("mobile")}}),s("el-table-column",{attrs:{label:e.$t("updatedAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.updated_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{label:e.$t("expiredAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.expired_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{label:e.$t("sshFilter")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.ssh_filter_group_id>0?s("el-link",{attrs:{type:"primary"},domProps:{textContent:e._s(t.row.ssh_filter_group.name)},on:{click:function(s){return e.linkSshFilterGroupView(t.row)}}}):e._e(),t.row.ssh_filter_group_id<1?s("span",{domProps:{textContent:e._s(e.$t("sshFilterGroupNone"))}}):e._e()]}}])}),s("el-table-column",{attrs:{fixed:"right",label:e.$t("action"),width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[s("el-button",{attrs:{title:"更新用户的密码和ssh密码ssh key",type:"success",size:"mini"},domProps:{textContent:e._s(e.$t("btnEdit"))},on:{click:function(s){return e.openDialogForm(t.row,"edit")}}}),s("el-button",{attrs:{title:"查看用户信息,SSH登录信息,网页端登录信息",type:"warning",size:"mini"},domProps:{textContent:e._s(e.$t("btnView"))},on:{click:function(s){return e.openDialogForm(t.row,"view")}}}),s("el-button",{attrs:{title:"授权的机器列表,跳转到机器列表",type:"primary",size:"mini"},domProps:{textContent:e._s(e.$t("btnUserMachines"))},on:{click:function(s){return e.doBindMachine(t.row)}}}),s("el-button",{attrs:{title:"SSH审计",type:"warning",size:"mini"},domProps:{textContent:e._s(e.$t("btnSshAudit"))},on:{click:function(s){return e.$router.push({name:"sshLog",query:{user_id:t.row.id}})}}}),s("el-button",{attrs:{title:"删除web账号和ssh账号,授权的机器,账号是软删除",type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}})],1)]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("comp-machine-user-bind-machine",{attrs:{user:e.form,visible:e.bindVisible},on:{"update:visible":function(t){e.bindVisible=t},afterClose:function(t){e.bindVisible=!1}}}),s("dialog-form-user",{attrs:{obj:e.form,id:0,visible:e.dfv,type:e.dfType},on:{afterClose:e.doDfAfterClose}}),s("dialog-form-filter-group",{attrs:{obj:e.sfgObj,type:"view",visible:e.sfgV,id:e.sfgObj.id},on:{afterClose:function(t){e.sfgV=!1}}})],1)},qe=[],Ne=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-steps",{attrs:{active:e.stepIdx,"finish-status":"success","align-center":""}},[s("el-step",{attrs:{title:"选择机器"}}),s("el-step",{attrs:{title:"设置权限"}})],1),s("el-transfer",{directives:[{name:"show",rawName:"v-show",value:1===e.stepIdx,expression:"stepIdx === 1"}],staticClass:"step-form",staticStyle:{display:"flex","justify-content":"space-between"},attrs:{titles:e.titles,filterable:"","filter-method":e.filterMethod,"filter-placeholder":e.$t("searchMachinePh"),data:e.machines},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),s("el-form",{directives:[{name:"show",rawName:"v-show",value:2===e.stepIdx,expression:"stepIdx === 2"}],ref:"ruleForm",staticClass:"step-form",attrs:{"label-width":"250px","label-position":"right",size:"mini"}},[e.selectedMachines.length>0?e._l(e.selectedMachines,(function(t,i){return s("el-form-item",{key:i,attrs:{label:t.name}},[s("el-radio-group",{model:{value:t.sudo_type,callback:function(s){e.$set(t,"sudo_type",e._n(s))},expression:"v.sudo_type"}},[s("el-radio",{attrs:{label:2}},[e._v("普通权限")]),s("el-radio",{attrs:{label:4}},[e._v("SUDO权限")]),s("el-radio",{attrs:{label:8}},[e._v("SUDO免密码")])],1)],1)})):e._e(),0===e.selectedMachines.length?s("h3",{staticStyle:{"text-align":"center"}},[e._v("取消全部机器授权")]):e._e()],2),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){e.v=!1}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"previous"},expression:"{path:'previous'}"},{name:"show",rawName:"v-show",value:2===e.stepIdx,expression:"stepIdx === 2"}],attrs:{type:"success"},on:{click:function(t){e.stepIdx=1}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"next"},expression:"{path:'next'}"},{name:"show",rawName:"v-show",value:1===e.stepIdx,expression:"stepIdx === 1"}],attrs:{type:"success"},on:{click:e.doNext}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"},{name:"show",rawName:"v-show",value:2===e.stepIdx,expression:"stepIdx === 2"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},Ee=[],Re={props:{user:{type:Object,require:!0},visible:Boolean},name:"CompMachineUserBindMachine",data(){return{selectedMachines:[],stepIdx:1,value:[],titles:["未分配","已授权"],machines:[],filterMethod(e,t){return t.label.indexOf(e)>-1},rawMachines:[],rawValues:{},v:this.visible}},watch:{visible(e){this.v=e},stepIdx(e){}},computed:{dTitle(){return this.$t("userBindMachine",{email:this.user.email})}},methods:{fetchAllMachine(){let e=1,t=9999;this.$http.get("machine",{params:{page:e,size:t}}).then(e=>{if(e){this.rawMachines=e.data;const t=[];e.data.forEach(e=>{t.push({key:e.id,label:`${e.name}-${e.ssh_ip}`,disabled:!1})}),this.machines=t}})},doOpen(){this.stepIdx=1,this.$http.get(`machine-user/machine-ids?user_id=${this.user.id}`).then(e=>{if(e){let t=[];e.data.forEach(e=>{t.push(e.machine_id)}),this.value=t,this.rawValues=e.data}}),this.fetchAllMachine()},doOpened(){},doNext(){1===this.stepIdx&&(this.stepIdx=2);const e=[];this.value.forEach(t=>{let s=this.rawMachines.find(e=>{return e.id===t}),i=this.rawValues.find(e=>{return e.machine_id===t});if(i||(i={sudo_type:2}),s){let a=`${s.name}-${s.ssh_ip}`,r=i.sudo_type;e.push({id:t,name:a,sudo_type:r})}}),this.selectedMachines=e},handleFormSubmit(){let e=this.user.id,t=[];this.selectedMachines.forEach(e=>{t.push({machine_id:e.id,sudo_type:e.sudo_type})}),this.$http.post("machine-user/bind-machine",{user_id:e,relations:t}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})}}},Be=Re,He=(s("3955"),Object(n["a"])(Be,Ne,Ee,!1,null,"dbfb3412",null)),Je=He.exports,Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-width":e.$store.state.dialogFormLabelWidth,rules:e.rules,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$t("filterGroupName"),prop:"name",required:""}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:e.$t("filterGroupRemark"),prop:"remark",required:""}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),e.form.filters&&e.form.filters.length>0?e._l(e.form.filters,(function(t,i){return s("el-form-item",{key:i,attrs:{label:e.$t("filterGroupFilter"),size:"small"}},[s("div",{staticClass:"filter"},[s("el-input",{staticStyle:{width:"35%"},attrs:{autocomplete:"off",disabled:e.isView,placeholder:e.$t("filterCommandPh")},model:{value:t.command,callback:function(s){e.$set(t,"command",s)},expression:"v.command"}}),s("el-input",{staticStyle:{width:"35%"},attrs:{autocomplete:"off",disabled:e.isView,placeholder:e.$t("filterMsgPh")},model:{value:t.msg,callback:function(s){e.$set(t,"msg",s)},expression:"v.msg"}}),s("el-switch",{attrs:{disabled:e.isView,title:"on/off","active-color":"#13ce66","inactive-color":"#ff4949","active-value":2,"inactive-value":4},model:{value:t.enable,callback:function(s){e.$set(t,"enable",e._n(s))},expression:"v.enable"}}),s("el-button",{attrs:{icon:"el-icon-delete",type:"text",disabled:e.isView},on:{click:function(s){return s.preventDefault(),e.doRemoveFilter(t)}}})],1)])})):[s("el-form-item",{attrs:{label:e.$t("filterGroupFilter"),size:"small"}},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"filterGroupAddRule"},expression:"{path:'filterGroupAddRule'}"}],attrs:{type:"warning",disabled:e.isView},on:{click:e.doAppendRule}})],1)]],2),e.isView?e._e():s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"filterGroupAddRule"},expression:"{path:'filterGroupAddRule'}"},{name:"show",rawName:"v-show",value:e.form.filters&&e.form.filters.length>0,expression:"form.filters && form.filters.length > 0"}],attrs:{type:"warning"},on:{click:e.doAppendRule}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){return e.$emit("afterClose")}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},We=[],Ke={name:"DialogFormFilterGroup",props:{obj:{type:Object,require:!0},id:{type:Number,require:!0},type:String,visible:Boolean},data(){return{isView:!1,v:this.visible,form:this.obj,rules:{}}},watch:{visible(e){this.v=e}},computed:{dTitle(){switch(this.type){case"create":return this.$t("sshFilterCreate");case"view":return this.$t("sshFilterView");case"edit":return this.$t("sshFilterUpdate");default:return""}}},methods:{doAppendRule(){let e={command:"",msg:"",enable:2};this.form.filters?this.form.filters&&Array.isArray(this.form.filters)&&this.form.filters.push(e):this.form.filters=[e]},doOpen(){this.isView="view"===this.type,this.form=this.obj,this.id>0&&this.obj&&this.$http.get(`filter-group/${this.id}`).then(e=>{e&&(this.form=e.data)})},postFormData(){let e="post",t="filter-group";"edit"===this.type&&(e="patch"),"create"===this.type&&(e="post"),this.form&&Array.isArray(this.form.filters)&&(this.form.filters=this.form.filters.filter(e=>{return e.command.trim().length>1}));let s=this.form;this.$http({method:e,url:t,data:s}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})},doRemoveFilter(e){let t=this.form.filters.indexOf(e);-1!==t&&this.form.filters.splice(t,1)},doOpened(){},handleFormSubmit(){this.$refs.ruleForm.validate(e=>{e?this.postFormData():this.$notify.error("form validation failed")})}}},Ye=Ke,Ze=(s("5531"),Object(n["a"])(Ye,Ge,We,!1,null,"5c9d16a0",null)),Xe=Ze.exports,Qe={name:"ViewUser",components:{CompMachineUserBindMachine:Je,DialogFormUser:ee,DialogFormFilterGroup:Xe},data(){return{sfgObj:{},sfgV:!1,dfv:!1,dfType:"view",bindVisible:!1,total:0,page:1,size:10,tableData:[],form:{},q:{}}},computed:{machine_id(){return this.$route.params.machine_id||0},machine_name(){return this.$route.query.machine_name||""}},mounted(){this.fetchAllUser()},created(){},methods:{linkSshFilterGroupView(e){this.sfgObj=e.ssh_filter_group,this.sfgV=!0},doAfterClose(){this.dfv=!1,"view"!==this.dfType&&this.fetchAllMachine()},doBindMachine(e){this.form=e,this.bindVisible=!0},parseRoleName(e){const t={2:"管理员",4:"用户"};return t[e.role]||""},doView(){this.$notify.success("查看用户")},pageChange(e){this.page=e,this.fetchAllUser()},sizeChange(e){this.page=1,this.size=e,this.fetchAllUser()},fetchAllUser(){let e=this.q;e.page=this.page,e.size=this.size,this.$http.get("user",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doClose(e){this.bindVisible=e},doDelete(e){this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.delete(`user/${e.id}`).then(e=>{e&&(this.fetchAllUser(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},openDialogForm(e,t){this.form=e,this.dfType=t,this.dfv=!0},doDfAfterClose(){this.dfv=!1,"create"===this.dfType&&this.fetchAllUser()}}},et=Qe,tt=Object(n["a"])(et,Oe,qe,!1,null,"36e4c0c8",null),st=tt.exports,it=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),e.isAdmin?s("el-button",{attrs:{type:"success",size:"small",title:"添加机器"},on:{click:function(t){return e.openDialogForm({id:0},"create")}}},[e._v("\n            "+e._s(e.$t("btnAdd"))+"\n        ")]):e._e(),s("div",{staticClass:"search-bar"},[s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("machineNamePhS"),clearable:""},on:{blur:e.fetchAllMachine},model:{value:e.q.name,callback:function(t){e.$set(e.q,"name",t)},expression:"q.name"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("machineSshIpPhS"),clearable:""},on:{blur:e.fetchAllMachine},model:{value:e.q.ssh_ip,callback:function(t){e.$set(e.q,"ssh_ip","string"===typeof t?t.trim():t)},expression:"q.ssh_ip"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("machineWanIpPhS"),clearable:""},on:{blur:e.fetchAllMachine},model:{value:e.q.wan_ip,callback:function(t){e.$set(e.q,"wan_ip","string"===typeof t?t.trim():t)},expression:"q.wan_ip"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("machineLanIpPhS"),clearable:""},on:{blur:e.fetchAllMachine},model:{value:e.q.lan_ip,callback:function(t){e.$set(e.q,"lan_ip","string"===typeof t?t.trim():t)},expression:"q.lan_ip"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllMachine}})],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"}},[s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{label:e.$t("machineName"),prop:"name"}}),s("el-table-column",{attrs:{label:e.$t("machineSshIp"),prop:"ssh_ip"}}),s("el-table-column",{attrs:{label:e.$t("machineSshPort"),prop:"ssh_port"}}),s("el-table-column",{attrs:{label:e.$t("machineLanIp"),prop:"lan_ip"}}),s("el-table-column",{attrs:{label:e.$t("machineWanIp"),prop:"wan_ip"}}),s("el-table-column",{attrs:{label:e.$t("machineCate")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.txtCate(t.row))+"\n            ")]}}])}),s("el-table-column",{attrs:{label:e.$t("machineType")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.machineUserType(t.row))+"\n            ")]}}])}),s("el-table-column",{attrs:{label:e.$t("clusterSsh")},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(e.getSshUser(t.row))},on:{click:function(s){return e.linkClusterSshInfo(t.row)}}})]}}])}),s("el-table-column",{attrs:{label:e.$t("clusterJumper")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.cluster_jumper_id>0?s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(t.row.cluster_jumper.name)},on:{click:function(s){return e.linkClusterJumperInfo(t.row)}}}):e._e(),t.row.cluster_jumper_id<1?s("span",{domProps:{textContent:e._s(e.$t("clusterJumperNone"))}}):e._e()]}}])}),s("el-table-column",{attrs:{label:e.$t("updatedAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.updated_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{fixed:"right",label:e.$t("action"),width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[e.isAdmin?s("el-button",{attrs:{title:e.$t("btnEdit"),type:"success",size:"mini"},domProps:{textContent:e._s(e.$t("btnEdit"))},on:{click:function(s){return e.openDialogForm(t.row,"edit")}}}):e._e(),s("el-button",{attrs:{title:e.$t("btnView"),type:"warning",size:"mini"},domProps:{textContent:e._s(e.$t("btnView"))},on:{click:function(s){return e.openDialogForm(t.row,"view")}}}),s("el-button",{attrs:{title:e.$t("hardware"),type:"info",size:"mini"},domProps:{textContent:e._s(e.$t("hardware"))},on:{click:function(s){return e.doHardware(t.row)}}}),s("el-button",{attrs:{title:e.$t("btnSsh"),type:"primary",size:"mini"},domProps:{textContent:e._s(e.$t("btnSsh"))},on:{click:function(s){return e.doSshTerm(t.row)}}}),s("el-button",{attrs:{title:e.$t("btnSftp"),type:"success",size:"mini"},domProps:{textContent:e._s(e.$t("btnSftp"))},on:{click:function(s){return e.doSftp(t.row)}}})],1),e.isAdmin?s("el-button-group",[s("el-button",{attrs:{title:e.$t("btnDelete"),type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}}),s("el-button",{attrs:{title:e.$t("btnSshAudit"),type:"warning",size:"mini"},domProps:{textContent:e._s(e.$t("btnSshAudit"))},on:{click:function(s){return e.$router.push({name:"sshLog",query:{machine_id:t.row.id}})}}}),s("el-button",{attrs:{title:e.$t("btnMachineUser"),type:"primary",size:"mini"},domProps:{textContent:e._s(e.$t("btnMachineUser"))},on:{click:function(s){return e.doMachineBindUser(t.row)}}})],1):e._e()]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("comp-term",{attrs:{obj:e.form,visible:e.termVisible},on:{afterClose:function(t){e.termVisible=!1}}}),s("comp-machine-user-bind-user",{attrs:{machine:e.form,visible:e.bindVisible},on:{afterClose:e.doClose}}),s("dialog-form-machine",{attrs:{obj:e.form,type:e.dfType,visible:e.dfV,id:0},on:{afterClose:e.doRefresh}}),s("dialog-form-cluster-ssh",{attrs:{obj:e.csObj,id:0,visible:e.csVisible,type:"view"},on:{afterClose:function(t){e.csVisible=!1}}}),s("dialog-form-cluster-jumper",{attrs:{obj:e.cjObj,id:0,visible:e.cjVisible,type:"view"},on:{afterClose:function(t){e.cjVisible=!1}}}),s("dialog-machine-hardware",{attrs:{machine:e.selectedRow,visible:e.dmhV},on:{afterClose:function(t){e.dmhV=!1}}})],1)},at=[],rt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.termTitle,center:"",fullscreen:"","custom-class":"felix-dialog"},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:e.doClose}},[s("div",{ref:"terminal",staticClass:"felix-xterm"})])},ot=[],lt=s("27ae");let nt={};nt.wsBase=`${"https:"===window.location.protocol?"wss://":"ws://"}${window.location.host}`,nt.apiBase=`${window.location.protocol}//:${window.location.host}`,window.location.host.includes("felix.mojotv.cn")&&(nt.wsBase="ws://felix.mojotv.cn:3333"),window.location.host.includes("127.0.0.1")&&(nt.wsBase="ws://127.0.0.1:8360"),window.location.host.includes("localhost")&&(nt.wsBase="ws://localhost:8360");var ct=nt;let ut=(e,t)=>{let s=e=>{t.send(JSON.stringify({type:"resize",rows:e.rows,cols:e.cols}))};e.on("resize",s),t.addEventListener("close",(function(){e.off("resize",s)}))},ht=(e,t,s,i)=>{e.write("\r\nMojotv-Ssh-Fortress堡垒机\n\r\n"),e.socket=t;let a=null,r=function(t){i&&i>0?a?a+=t.data:(a=t.data,setTimeout((function(){e.write(a)}),i)):e.write(t.data)},o=function(e){t.send(JSON.stringify({type:"cmd",cmd:lt["Base64"].encode(e)}))};t.onmessage=r,s&&e.on("data",o);let l=setInterval((function(){t.send(JSON.stringify({type:"heartbeat",data:""}))}),2e4);t.addEventListener("close",(function(){t.removeEventListener("message",r),e.off("data",o),delete e.socket,clearInterval(l)}))};var dt={props:{obj:{type:Object,require:!0},visible:Boolean},name:"CompTerm",data(){return{isFullScreen:!1,searchKey:"",v:this.visible,ws:null,term:null,thisV:this.visible}},watch:{visible(e){this.v=e}},computed:{termTitle(){return this.obj&&this.obj.cluster_ssh?`${this.obj.cluster_ssh.ssh_user||""}@${this.obj.ssh_ip}:${this.obj.ssh_port}`:""},wsUrl(){let e=localStorage.getItem("token");return`${ct.wsBase}/api/ws/${this.obj.id||0}?cols=${this.term.cols}&rows=${this.term.rows}&_t=${e}`}},methods:{onWindowResize(){this.term.fit()},doLink(e,t){"click"===e.type&&window.open(t)},doClose(){window.removeEventListener("resize",this.onWindowResize),this.ws&&this.ws.close(),this.term&&this.term.dispose(),this.$emit("afterClose")},doOpen(){},doOpened(){ye["Terminal"].applyAddon($e),ye["Terminal"].applyAddon(ke),ye["Terminal"].applyAddon(Se),this.term=new ye["Terminal"]({fontSize:18,cursorBlink:!0,cursorStyle:"bar",bellStyle:"sound"}),this.term.open(this.$refs.terminal),this.term.fit(),this.term.webLinksInit(this.doLink),window.addEventListener("resize",this.onWindowResize),this.ws=new WebSocket(this.wsUrl),this.ws.onclose=e=>{this.term.setOption("cursorBlink",!1),1005!==e.code&&(this.$notify.error({title:`code ${e.code}`,message:e.reason}),this.doClose())},ht(this.term,this.ws,!0,-1),ut(this.term,this.ws)}}},pt=dt,mt=(s("34cf"),Object(n["a"])(pt,rt,ot,!1,null,null,null)),ft=mt.exports,bt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:e.doClose}},[s("el-steps",{attrs:{active:e.stepIdx,"finish-status":"success","align-center":""}},[s("el-step",{attrs:{title:"选择用户"}}),s("el-step",{attrs:{title:"设置权限"}})],1),s("el-transfer",{directives:[{name:"show",rawName:"v-show",value:1===e.stepIdx,expression:"stepIdx === 1"}],staticClass:"step-form",staticStyle:{display:"flex","justify-content":"space-between"},attrs:{titles:e.titles,filterable:"","filter-method":e.filterMethod,"filter-placeholder":e.$t("searchUserPh"),data:e.users},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),s("el-form",{directives:[{name:"show",rawName:"v-show",value:2===e.stepIdx,expression:"stepIdx === 2"}],ref:"ruleForm",staticClass:"step-form",attrs:{"label-width":"250px","label-position":"right",size:"mini"}},[e.selectedUsers.length>0?e._l(e.selectedUsers,(function(t,i){return s("el-form-item",{key:i,attrs:{label:t.name}},[s("el-radio-group",{model:{value:t.sudo_type,callback:function(s){e.$set(t,"sudo_type",e._n(s))},expression:"v.sudo_type"}},[s("el-radio",{attrs:{label:2}},[e._v("普通权限")]),s("el-radio",{attrs:{label:4}},[e._v("SUDO权限")]),s("el-radio",{attrs:{label:8}},[e._v("SUDO免密码")])],1)],1)})):e._e(),0===e.selectedUsers.length?s("h3",{staticStyle:{"text-align":"center"}},[e._v("取消全部机器授权")]):e._e()],2),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){e.v=!1}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"previous"},expression:"{path:'previous'}"},{name:"show",rawName:"v-show",value:2===e.stepIdx,expression:"stepIdx === 2"}],attrs:{type:"success"},on:{click:function(t){e.stepIdx=1}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"next"},expression:"{path:'next'}"},{name:"show",rawName:"v-show",value:1===e.stepIdx,expression:"stepIdx === 1"}],attrs:{type:"success"},on:{click:e.doNext}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"},{name:"show",rawName:"v-show",value:2===e.stepIdx,expression:"stepIdx === 2"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},gt=[],wt={props:{machine:{type:Object,require:!0},visible:Boolean},name:"CompMachineUserBindUser",data(){return{selectedUsers:[],stepIdx:1,value:[],titles:["未分配","已授权"],users:[],rawUsers:[],filterMethod(e,t){return t.label.indexOf(e)>-1},v:this.visible}},watch:{visible(e){this.v=e}},computed:{dTitle(){return this.$t("machineBindUser",{name:this.machine.name})}},methods:{fetchAllUser(){let e=1,t=9999;this.$http.get("user",{params:{page:e,size:t}}).then(e=>{if(e){this.rawUsers=e.data;const t=[];e.data.forEach(e=>{t.push({key:e.id,label:`${e.real_name}-${e.email}`,disabled:!1})}),this.users=t}})},doClose(){this.$emit("afterClose")},doOpen(){this.stepIdx=1,this.fetchAllUser(),this.$http.get(`machine-user/user-ids?machine_id=${this.machine.id}`).then(e=>{if(e){this.rawValues=e.data;let t=[];e.data.forEach(e=>{t.push(e.user_id)}),this.value=t}})},doOpened(){},doNext(){1===this.stepIdx&&(this.stepIdx=2);const e=[];this.value.forEach(t=>{let s=this.rawUsers.find(e=>{return e.id===t}),i=this.rawValues.find(e=>{return e.user_id===t});if(i||(i={sudo_type:2}),s){let a=`${s.name}-${s.email}`,r=i.sudo_type;e.push({id:t,name:a,sudo_type:r})}}),this.selectedUsers=e},handleFormSubmit(){let e=this.machine.id,t=[];this.selectedUsers.forEach(e=>{t.push({user_id:e.id,sudo_type:e.sudo_type})}),this.$http.post("machine-user/bind-user",{relations:t,machine_id:e}).then(e=>{e&&(this.$message.success("success"),this.doClose())})}}},vt=wt,_t=(s("206f"),Object(n["a"])(vt,bt,gt,!1,null,null,null)),yt=_t.exports,$t=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-width":e.$store.state.dialogFormLabelWidth,rules:e.rules,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$t("sshUser"),prop:"ssh_user"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.ssh_user,callback:function(t){e.$set(e.form,"ssh_user","string"===typeof t?t.trim():t)},expression:"form.ssh_user"}})],1),s("el-form-item",{attrs:{label:e.$t("sshType"),required:""}},[s("el-radio-group",{attrs:{disabled:e.isView},model:{value:e.form.ssh_type,callback:function(t){e.$set(e.form,"ssh_type",t)},expression:"form.ssh_type"}},[s("el-radio",{attrs:{label:"password"}},[e._v(e._s(e.$t("sshTypePassword")))]),s("el-radio",{attrs:{label:"key"}},[e._v(e._s(e.$t("sshTypeKey")))])],1)],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"password"===e.form.ssh_type,expression:"form.ssh_type === 'password'"}],attrs:{label:e.$t("sshPassword"),prop:"input_ssh_password"}},[s("el-input",{attrs:{type:"password","prefix-icon":"el-icon-c-scale-to-original","show-password":"",autocomplete:"off",disabled:e.isView},model:{value:e.form.input_ssh_password,callback:function(t){e.$set(e.form,"input_ssh_password","string"===typeof t?t.trim():t)},expression:"form.input_ssh_password"}})],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"key"===e.form.ssh_type,expression:"form.ssh_type === 'key'"}],attrs:{label:e.$t("sshKey"),prop:"input_ssh_key"}},[s("el-input",{attrs:{type:"textarea",rows:5,placeholder:e.$t("sshKeyPhS"),disabled:e.isView,maxlength:"2048","show-word-limit":"",autocomplete:"off"},model:{value:e.form.input_ssh_key,callback:function(t){e.$set(e.form,"input_ssh_key","string"===typeof t?t.trim():t)},expression:"form.input_ssh_key"}})],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"key"===e.form.ssh_type,expression:"form.ssh_type === 'key'"}],attrs:{label:e.$t("sshKeyPassword"),prop:"input_ssh_key_password"}},[s("el-input",{attrs:{type:"password","prefix-icon":"el-icon-c-scale-to-original","show-password":"",minlength:"4",maxlength:"20","show-word-limit":"",autocomplete:"off",disabled:e.isView},model:{value:e.form.input_ssh_key_password,callback:function(t){e.$set(e.form,"input_ssh_key_password","string"===typeof t?t.trim():t)},expression:"form.input_ssh_key_password"}})],1),s("el-form-item",{attrs:{label:e.$t("remark")}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e.isView?e._e():s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){return e.$emit("afterClose")}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},kt=[],St={name:"DialogFormClusterSsh",props:{obj:{type:Object,require:!0},id:{type:Number,require:!0},type:String,visible:Boolean},data(){return{v:this.visible,isView:!1,form:this.obj,rules:{ssh_user:[{required:!0,trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],input_ssh_key_password:[{type:"string",min:3,max:20,message:"长度在3到20个字符",trigger:"blur"}],input_ssh_password:[{type:"string",min:3,max:20,message:"长度在3到20个字符",trigger:"blur"}]}}},watch:{visible(e){this.v=e}},computed:{dTitle(){switch(this.type){case"create":return this.$t("clusterSshCreate");case"view":return this.$t("clusterSshView");case"edit":return this.$t("clusterSshUpdate");default:return""}}},methods:{doOpen(){this.form=this.obj,this.isView="view"===this.type,this.isView&&this.id>0&&this.obj&&this.$http.get(`cluster-ssh/${this.id}`).then(e=>{e&&(this.form=e.data)})},postFormData(){let e="post",t="cluster-ssh";"edit"===this.type&&(e="patch"),"create"===this.type&&(e="post");let s=this.form;this.$http({method:e,url:t,data:s}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})},doOpened(){},handleFormSubmit(){this.$refs.ruleForm.validate(e=>{e?this.postFormData():this.$notify.error("表单错误")})}}},xt=St,Ct=Object(n["a"])(xt,$t,kt,!1,null,"0c44c6ed",null),Pt=Ct.exports,At=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-tabs",{attrs:{stretch:"",type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.info,(function(t,i){return s("el-tab-pane",{key:i,attrs:{label:e.$t(i),name:i}},[s("pre",{domProps:{textContent:e._s(t)}})])})),1)],1)},Dt=[],zt={name:"DialogMachineHardware",props:{visible:Boolean,machine:{type:Object,require:!0}},data(){return{activeName:"hi_login",info:[],v:this.visible}},watch:{visible(e){this.v=e}},computed:{dTitle(){return`${this.$t("hardware")}: ${this.machine.name||""} (${this.machine.ssh_ip||""}) `||""}},methods:{doOpen(){this.$http.get(`/machine/${this.machine.id}/hardware`).then(e=>{e&&(this.info=e.data)})},doOpened(){}}},Ut=zt,jt=(s("de75"),Object(n["a"])(Ut,At,Dt,!1,null,"f2ebc954",null)),Ft=jt.exports,Tt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-width":e.$store.state.dialogFormLabelWidth,rules:e.rules,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$t("clusterJumperName"),prop:"name"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:e.$t("sshUser"),prop:"ssh_user"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.ssh_user,callback:function(t){e.$set(e.form,"ssh_user","string"===typeof t?t.trim():t)},expression:"form.ssh_user"}})],1),s("el-form-item",{attrs:{label:e.$t("clusterJumperSshAddr"),prop:"ssh_addr"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.ssh_addr,callback:function(t){e.$set(e.form,"ssh_addr","string"===typeof t?t.trim():t)},expression:"form.ssh_addr"}})],1),s("el-form-item",{attrs:{label:e.$t("clusterJumperSshPort"),prop:"ssh_port"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.ssh_port,callback:function(t){e.$set(e.form,"ssh_port",e._n(t))},expression:"form.ssh_port"}})],1),s("el-form-item",{attrs:{label:e.$t("sshType"),required:""}},[s("el-radio-group",{attrs:{disabled:e.isView},model:{value:e.form.ssh_type,callback:function(t){e.$set(e.form,"ssh_type",t)},expression:"form.ssh_type"}},[s("el-radio",{attrs:{label:"password"}},[e._v(e._s(e.$t("sshTypePassword")))]),s("el-radio",{attrs:{label:"key"}},[e._v(e._s(e.$t("sshTypeKey")))])],1)],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"password"===e.form.ssh_type,expression:"form.ssh_type === 'password'"}],attrs:{label:e.$t("sshPassword"),prop:"password"}},[s("el-input",{attrs:{type:"password","prefix-icon":"el-icon-c-scale-to-original","show-password":"",autocomplete:"off",disabled:e.isView},model:{value:e.form.input_ssh_password,callback:function(t){e.$set(e.form,"input_ssh_password","string"===typeof t?t.trim():t)},expression:"form.input_ssh_password"}})],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"key"===e.form.ssh_type,expression:"form.ssh_type === 'key'"}],attrs:{label:e.$t("sshKey"),prop:"input_ssh_key"}},[s("el-input",{attrs:{type:"textarea",rows:5,placeholder:e.$t("sshKeyPhS"),disabled:e.isView,maxlength:"2048","show-word-limit":"",autocomplete:"off"},model:{value:e.form.input_ssh_key,callback:function(t){e.$set(e.form,"input_ssh_key","string"===typeof t?t.trim():t)},expression:"form.input_ssh_key"}})],1),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"key"===e.form.ssh_type,expression:"form.ssh_type === 'key'"}],attrs:{label:e.$t("sshKeyPassword"),prop:"input_ssh_key_password"}},[s("el-input",{attrs:{type:"password","prefix-icon":"el-icon-c-scale-to-original","show-password":"",minlength:"4",maxlength:"20","show-word-limit":"",autocomplete:"off",disabled:e.isView},model:{value:e.form.input_ssh_key_password,callback:function(t){e.$set(e.form,"input_ssh_key_password","string"===typeof t?t.trim():t)},expression:"form.input_ssh_key_password"}})],1),s("el-form-item",{attrs:{label:e.$t("remark")}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e.isView?e._e():s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){return e.$emit("afterClose")}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},Lt=[],Vt={name:"DialogFormClusterJumper",props:{obj:{type:Object,require:!0},id:{type:Number,require:!0},type:String,visible:Boolean},data(){return{v:this.visible,isView:!1,form:this.obj,rules:{name:[{required:!0,trigger:"blur"}],ssh_addr:[{required:!0,trigger:"blur"}],ssh_port:[{required:!0,trigger:"blur"}],ssh_user:[{required:!0,trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],input_ssh_key_password:[{type:"string",min:3,max:20,message:"长度在3到20个字符",trigger:"blur"}],input_ssh_password:[{type:"string",min:3,max:20,message:"长度在3到20个字符",trigger:"blur"}]}}},watch:{visible(e){this.v=e}},computed:{dTitle(){switch(this.type){case"create":return this.$t("clusterJumperCreate");case"view":return this.$t("clusterJumperView");case"edit":return this.$t("clusterJumperUpdate");default:return""}}},methods:{doOpen(){this.form=this.obj,this.isView="view"===this.type,this.isView&&this.id>0&&this.obj&&this.$http.get(`cluster-jumper/${this.id}`).then(e=>{e&&(this.form=e.data)})},postFormData(){let e="post",t="cluster-jumper";"edit"===this.type&&(e="patch"),"create"===this.type&&(e="post");let s=this.form;this.$http({method:e,url:t,data:s}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})},doOpened(){},handleFormSubmit(){this.$refs.ruleForm.validate(e=>{e?this.postFormData():this.$notify.error("表单错误")})}}},Mt=Vt,It=Object(n["a"])(Mt,Tt,Lt,!1,null,"2f0ef6b6",null),Ot=It.exports,qt={name:"ViewMachine",components:{CompTerm:ft,CompMachineUserBindUser:yt,DialogFormClusterJumper:Ot,DialogFormMachine:Te,DialogFormClusterSsh:Pt,DialogMachineHardware:Ft},data(){return{selectedRow:{id:0},dmhV:!1,csObj:{},csVisible:!1,cjObj:{},cjVisible:!1,bindVisible:!1,termVisible:!1,formTitle:"机器添加",dfV:!1,dfType:"",total:0,page:1,size:10,tableData:[],form:{ssh_port:22,cate:2},q:{}}},computed:{user(){return this.$store.state.user},email(){return this.$store.getters.userEmail},isAdmin(){return this.$store.getters.userIsAdmin},uid(){return this.$store.getters.userId},qUid(){return this.$route.query.user_id},cluster_ssh_id(){return this.$route.query.cluster_ssh_id||0}},mounted(){this.fetchAllMachine()},created(){},methods:{linkClusterSshInfo(e){this.csObj=e.cluster_ssh,this.csVisible=!0},linkClusterJumperInfo(e){this.cjObj=e.cluster_jumper,this.cjVisible=!0},doRefresh(){this.dfV=!1,"view"!==this.dfType&&this.fetchAllMachine()},pageChange(e){this.page=e,this.fetchAllMachine()},txtCate(e){return 2===e.cate?this.$t("machineCateLan"):4===e.cate?this.$t("machineCateWan"):""},doHardware(e){this.selectedRow=e,this.dmhV=!0},machineUserType(e){return e.user_id===this.uid?this.$t("owned"):this.$t("assigned")},doSshTerm(e){this.form=e,this.termVisible=!0},doSftp(e){let t=e.id,s=e.ssh_ip,i=this.getSshUser(e);this.$router.push({name:"sftp",params:{id:t,sshIp:s,user:i}})},getSshUser(e){return e.cluster_ssh&&e.cluster_ssh.ssh_user||""},sizeChange(e){this.page=1,this.size=e,this.fetchAllMachine()},doMachineBindUser(e){this.form=e,this.bindVisible=!0},fetchAllMachine(){let e=this.q;e.page=this.page,e.size=this.size,this.$http.get("machine",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doDelete(e){this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.delete(`machine/${e.id}`).then(e=>{e&&(this.fetchAllMachine(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},doView(e){this.$notify.success("查看机器更多相相关信息:"+e.id)},doClose(e){this.bindVisible=e,this.termVisible=e},openDialogForm(e,t){this.form=e,this.dfType=t,this.dfV=!0}}},Nt=qt,Et=Object(n["a"])(Nt,it,at,!1,null,"675f849c",null),Rt=Et.exports,Bt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),s("el-button",{attrs:{type:"success",size:"small",title:"向当前机器添加SSH用户"},on:{click:function(t){return e.openDialogForm({id:0,ssh_type:"password"},"create")}}},[e._v(e._s(e.$t("btnAdd"))+"\n        ")]),s("div",{staticClass:"search-bar"},[s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("sshRemarkPhS"),clearable:""},on:{blur:e.fetchAllClusterSsh},model:{value:e.q.remark,callback:function(t){e.$set(e.q,"remark",t)},expression:"q.remark"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("sshUserPhS"),clearable:""},on:{blur:e.fetchAllClusterSsh},model:{value:e.q.ssh_user,callback:function(t){e.$set(e.q,"ssh_user","string"===typeof t?t.trim():t)},expression:"q.ssh_user"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllClusterSsh}})],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"}},[s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{label:e.$t("sshRemark"),prop:"remark"}}),s("el-table-column",{attrs:{label:e.$t("sshUser"),prop:"ssh_user"}}),s("el-table-column",{attrs:{label:e.$t("sshType"),prop:"ssh_type"}}),s("el-table-column",{attrs:{label:e.$t("updatedAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.updated_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{fixed:"right",label:e.$t("action"),width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[s("el-button",{attrs:{title:e.$t("btnEdit"),type:"success",size:"mini"},domProps:{textContent:e._s(e.$t("btnEdit"))},on:{click:function(s){return e.openDialogForm(t.row,"edit")}}}),s("el-button",{attrs:{title:"view detail",type:"warning",size:"mini"},domProps:{textContent:e._s(e.$t("btnView"))},on:{click:function(s){return e.openDialogForm(t.row,"view")}}}),s("el-button",{attrs:{title:"assign machines",type:"primary",size:"mini"},domProps:{textContent:e._s(e.$t("assignMachines"))},on:{click:function(s){return e.assignMachine(t.row)}}}),s("el-button",{attrs:{title:e.$t("btnDelete"),type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}})],1)]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("dialog-form-cluster-ssh",{attrs:{obj:e.form,type:e.dfType,visible:e.dfV,id:0},on:{afterClose:e.doRefresh}}),s("comp-cluster-ssh-bind-machine",{attrs:{obj:e.form,visible:e.compV},on:{afterClose:function(t){e.compV=!1}}})],1)},Ht=[],Jt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-transfer",{staticClass:"step-form",staticStyle:{display:"flex","justify-content":"space-between"},attrs:{titles:e.titles,filterable:"","filter-method":e.filterMethod,"filter-placeholder":e.$t("searchMachinePh"),data:e.users},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){e.v=!1}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},Gt=[],Wt={props:{obj:{type:Object,require:!0},visible:Boolean},name:"CompClusterJumperBindMachine",data(){return{value:[],titles:["未分配","已绑定"],users:[],rawUsers:[],filterMethod(e,t){return t.label.indexOf(e)>-1},v:this.visible}},watch:{visible(e){this.v=e}},computed:{dTitle(){return this.$t("clusterSshBindMachine",this.obj)}},methods:{doOpen(){let e=1,t=9999;this.$http.get("machine",{params:{page:e,size:t}}).then(e=>{if(e){this.rawUsers=e.data;const t=[],s=[],i=this.obj.id;e.data.forEach(e=>{t.push({key:e.id,label:`${e.name}-${e.ssh_ip}`,disabled:!1}),e.cluster_ssh_id===i&&s.push(e.id)}),this.users=t,this.value=s}})},doOpened(){},handleFormSubmit(){let e=this.obj.id,t=this.value;this.$http.post("cluster-ssh-bind",{cluster_ssh_id:e,machine_ids:t}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})}}},Kt=Wt,Yt=(s("5a94"),Object(n["a"])(Kt,Jt,Gt,!1,null,null,null)),Zt=Yt.exports,Xt={components:{DialogFormClusterSsh:Pt,CompClusterSshBindMachine:Zt},name:"ViewClusterSsh",data(){return{q:{remark:"",ssh_user:""},compV:!1,dfType:"",dfV:!1,total:0,page:1,size:10,tableData:[],form:{}}},mounted(){this.fetchAllClusterSsh()},methods:{assignMachine(e){this.form=e,this.compV=!0},doRefresh(){this.dfV=!1,"view"!==this.dfType&&this.fetchAllClusterSsh()},pageChange(e){this.page=e,this.fetchAllClusterSsh()},sizeChange(e){this.page=1,this.size=e,this.fetchAllClusterSsh()},fetchAllClusterSsh(){let e=this.q;e.page=this.page,e.size=this.size,this.$http.get("cluster-ssh",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doDelete(e){this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.delete(`cluster-ssh/${e.id}`).then(e=>{e&&(this.fetchAllClusterSsh(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},openDialogForm(e,t){this.form=e,this.dfType=t,this.dfV=!0}}},Qt=Xt,es=Object(n["a"])(Qt,Bt,Ht,!1,null,"432a4ba2",null),ts=es.exports,ss=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),e.selectedRows&&e.selectedRows.length>0?s("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.doDeleteAll}},[e._v("\n            "+e._s(e.$t("rmSelected"))+"\n        ")]):e._e(),s("div",{staticClass:"search-bar"},[s("el-select",{staticStyle:{"margin-right":"1rem"},attrs:{size:"small",clearable:"",placeholder:e.$t("siginLogTypePhS")},on:{change:e.fetchLoginLog},model:{value:e.q.login_type,callback:function(t){e.$set(e.q,"login_type",t)},expression:"q.login_type"}},e._l(["password","github"],(function(e,t){return s("el-option",{key:t,attrs:{label:e,value:e}})})),1),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("siginLogClientIpPhS"),clearable:""},on:{change:e.fetchLoginLog},model:{value:e.q.client_ip,callback:function(t){e.$set(e.q,"client_ip","string"===typeof t?t.trim():t)},expression:"q.client_ip"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("siginLogEmailPhS"),clearable:""},on:{change:e.fetchLoginLog},model:{value:e.q.email,callback:function(t){e.$set(e.q,"email","string"===typeof t?t.trim():t)},expression:"q.email"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("siginLogUserNamePhS"),clearable:""},on:{change:e.fetchLoginLog},model:{value:e.q.user_name,callback:function(t){e.$set(e.q,"user_name","string"===typeof t?t.trim():t)},expression:"q.user_name"}}),s("el-date-picker",{staticStyle:{"margin-right":"1rem"},attrs:{size:"small","value-format":"yyyy-MM-dd HH:mm:ss",type:"daterange",align:"right","unlink-panels":"","range-separator":e.$t("to"),"start-placeholder":e.$t("sshLogStartTimePhS"),"end-placeholder":e.$t("sshLogEndTimePhS"),"picker-options":e.pickerOptions},on:{change:e.fetchLoginLog},model:{value:e.range,callback:function(t){e.range=t},expression:"range"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchLoginLog}})],1)],1),s("el-table",{attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{label:e.$t("clientIp"),prop:"client_ip"}}),s("el-table-column",{attrs:{label:e.$t("loginType"),prop:"login_type"}}),s("el-table-column",{attrs:{label:e.$t("userId")},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(t.row.user_name)},on:{click:function(s){return e.linkUserInfo(t.row)}}})]}}])}),s("el-table-column",{attrs:{label:e.$t("email"),prop:"email"}}),s("el-table-column",{attrs:{label:e.$t("userAgent"),prop:"user_agent"}}),s("el-table-column",{attrs:{label:e.$t("createdAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.created_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isAdmin?s("el-button-group",[s("el-button",{attrs:{title:"delete a row",type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}})],1):e._e()]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("dialog-form-user",{attrs:{obj:e.objUser,type:"view",visible:e.dfvUser,id:0},on:{afterClose:function(t){e.dfvUser=!1}}})],1)},is=[],as={components:{DialogFormUser:ee},name:"ViewSigninLog",data(){return{selectedRows:null,pickerOptions:{shortcuts:[{text:this.$t("last1day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-1),e.$emit("pick",[s,t])}},{text:this.$t("last3day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-3),e.$emit("pick",[s,t])}},{text:this.$t("last7day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-7),e.$emit("pick",[s,t])}},{text:this.$t("last1month"),onClick(e){const t=new Date,s=new Date;s.setMonth(s.getMonth()-1),e.$emit("pick",[s,t])}}]},objUser:{},dfvUser:!1,csObj:{},csVisible:!1,bindVisible:!1,termVisible:!1,formTitle:"机器添加",dfV:!1,dfType:"",total:0,page:1,size:10,tableData:[],form:{ssh_port:22,cate:2},q:{},range:[]}},computed:{user(){return this.$store.state.user},email(){return this.$store.getters.userEmail},isAdmin(){return this.$store.getters.userIsAdmin},uid(){return this.$store.getters.userId},qUid(){return this.$route.query.user_id},cluster_ssh_id(){return this.$route.query.cluster_ssh_id||0}},mounted(){this.fetchLoginLog()},created(){},methods:{handleSelectionChange(e){this.selectedRows=e},linkUserInfo(e){this.objUser=e.user,this.dfvUser=!0},pageChange(e){this.page=e,this.fetchLoginLog()},sizeChange(e){this.page=1,this.size=e,this.fetchLoginLog()},fetchLoginLog(){let e=this.q;e.page=this.page,e.size=this.size,2===this.range.length&&(e.from_time=this.range[0],e.to_time=this.range[1]),this.$http.get("signin-log",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doDeleteAll(){if(!this.selectedRows||0===this.selectedRows.length)return;const e=[];this.selectedRows.forEach(t=>{e.push(t.id)}),this.privateRm(e)},privateRm(e){e&&Array.isArray(e)&&this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.post("signin-log-rm",e).then(e=>{e&&(this.fetchLoginLog(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},doDelete(e){this.privateRm([e.id])}}},rs=as,os=Object(n["a"])(rs,ss,is,!1,null,"14b3030e",null),ls=os.exports,ns=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),e.selectedRows&&e.selectedRows.length>0?s("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.doDeleteAll}},[e._v("\n            "+e._s(e.$t("rmSelected"))+"\n        ")]):e._e(),s("div",{staticClass:"search-bar"},[s("el-select",{staticStyle:{"margin-right":"1rem"},attrs:{size:"small",clearable:"",placeholder:e.$t("sftpLogActionPhS")},on:{change:e.fetchAllSftpLog},model:{value:e.q.action,callback:function(t){e.$set(e.q,"action",t)},expression:"q.action"}},e._l(["ls","mkdir","upload","rm-file","rm-dir","dl-file","dl-dir","rename","cate"],(function(t,i){return s("el-option",{key:i,attrs:{label:e.$t(t),value:t}})})),1),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("sftpLogPathPhS"),clearable:""},on:{change:e.fetchAllSftpLog},model:{value:e.q.path,callback:function(t){e.$set(e.q,"path",t)},expression:"q.path"}}),s("el-date-picker",{staticStyle:{"margin-right":"1rem"},attrs:{size:"small","value-format":"yyyy-MM-dd HH:mm:ss",type:"daterange",align:"right","unlink-panels":"","range-separator":e.$t("to"),"start-placeholder":e.$t("sshLogStartTimePhS"),"end-placeholder":e.$t("sshLogEndTimePhS"),"picker-options":e.pickerOptions},on:{change:e.fetchAllSftpLog},model:{value:e.range,callback:function(t){e.range=t},expression:"range"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllSftpLog}})],1)],1),s("el-table",{ref:"multipleTable",attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),s("el-table-column",{attrs:{label:e.$t("machineId")},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(t.row.machine.name)},on:{click:function(s){return e.linkMachineInfo(t.row)}}})]}}])}),s("el-table-column",{attrs:{label:e.$t("userId")},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(t.row.user.name)},on:{click:function(s){return e.linkUserInfo(t.row)}}})]}}])}),s("el-table-column",{attrs:{label:e.$t("clientIp"),prop:"client_ip"}}),s("el-table-column",{attrs:{label:e.$t("sftpAction")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.$t(t.row.action))+"\n            ")]}}])}),s("el-table-column",{attrs:{label:e.$t("auditStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.txtCate(t.row))+"\n            ")]}}])}),s("el-table-column",{attrs:{label:e.$t("sftpPath"),prop:"path"}}),s("el-table-column",{attrs:{label:e.$t("sshUser"),prop:"ssh_user"}}),s("el-table-column",{attrs:{label:e.$t("updatedAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.updated_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{label:e.$t("createdAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.created_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[s("el-button",{attrs:{title:"delete a row",type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}})],1)]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("dialog-form-machine",{attrs:{obj:e.objMachine,type:"view",visible:e.dfvMachine,id:0},on:{afterClose:function(t){e.dfvMachine=!1}}}),s("dialog-form-user",{attrs:{obj:e.objUser,type:"view",visible:e.dfvUser,id:0},on:{afterClose:function(t){e.dfvUser=!1}}})],1)},cs=[],us={components:{DialogFormMachine:Te,DialogFormUser:ee},name:"ViewSftpLog",data(){return{selectedRows:null,pickerOptions:{shortcuts:[{text:this.$t("last1day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-1),e.$emit("pick",[s,t])}},{text:this.$t("last3day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-3),e.$emit("pick",[s,t])}},{text:this.$t("last7day"),onClick(e){const t=new Date,s=new Date;s.setDate(s.getDate()-7),e.$emit("pick",[s,t])}},{text:this.$t("last1month"),onClick(e){const t=new Date,s=new Date;s.setMonth(s.getMonth()-1),e.$emit("pick",[s,t])}}]},q:{path:"",action:""},range:[],objUser:{},dfvUser:!1,objMachine:{},dfvMachine:!1,termVisible:!1,formTitle:"机器添加",total:0,page:1,size:10,tableData:[],form:{ssh_port:22,cate:2}}},computed:{user(){return this.$store.state.user},email(){return this.$store.getters.userEmail},isAdmin(){return this.$store.getters.userIsAdmin},user_id(){return parseInt(this.$route.query.user_id)||0},machine_id(){return parseInt(this.$route.query.machine_id)||0}},mounted(){this.fetchAllSftpLog()},created(){},methods:{handleSelectionChange(e){this.selectedRows=e},countLogLineCount(e){return e.log.split("\n").length},linkMachineInfo(e){this.objMachine=e.machine,this.dfvMachine=!0},linkUserInfo(e){this.objUser=e.user,this.dfvUser=!0},doCreate(){this.form={id:0,cate:2,ssh_port:22},this.formTitle=this.$t("machineAddTitle")},pageChange(e){this.page=e,this.fetchAllSftpLog()},txtCate(e){let t={0:"未标记",2:"正常",4:"警告",8:"危险",16:"致命"};return t[e.status]},sizeChange(e){this.page=1,this.size=e,this.fetchAllSftpLog()},fetchAllSftpLog(){let e=this.q;e.page=this.page,e.size=this.size,e.user_id=this.user_id,e.machine_id=this.machine_id,2===this.range.length&&(e.from_time=this.range[0],e.to_time=this.range[1]),this.$http.get("sftp-log",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doDeleteAll(){if(!this.selectedRows||0===this.selectedRows.length)return;const e=[];this.selectedRows.forEach(t=>{e.push(t.id)}),this.privateRm(e)},privateRm(e){e&&Array.isArray(e)&&this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.post("sftp-log-rm",e).then(e=>{e&&(this.fetchAllSftpLog(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},doDelete(e){this.privateRm([e.id])},doView(e){this.form=e,this.termVisible=!0},doAfterClose(){this.fetchAllSftpLog(),this.termVisible=!1}}},hs=us,ds=Object(n["a"])(hs,ns,cs,!1,null,"0e87d13a",null),ps=ds.exports,ms=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),s("div",{staticClass:"search-bar"},[s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("feedbackPageUrlPhS"),clearable:""},on:{blur:e.fetchAllFeedback},model:{value:e.q.page_url,callback:function(t){e.$set(e.q,"page_url","string"===typeof t?t.trim():t)},expression:"q.page_url"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("feedbackEmailPhS"),clearable:""},on:{blur:e.fetchAllFeedback},model:{value:e.q.email,callback:function(t){e.$set(e.q,"email","string"===typeof t?t.trim():t)},expression:"q.email"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("feedbackUserNamePhS"),clearable:""},on:{blur:e.fetchAllFeedback},model:{value:e.q.user_name,callback:function(t){e.$set(e.q,"user_name","string"===typeof t?t.trim():t)},expression:"q.user_name"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("feedbackContentPhS"),clearable:""},on:{blur:e.fetchAllFeedback},model:{value:e.q.content,callback:function(t){e.$set(e.q,"content",t)},expression:"q.content"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllFeedback}})],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"}},[s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{label:e.$t("feedbackUser"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(t.row.user_name)},on:{click:function(s){return e.linkUserInfo(t.row.user_id)}}})]}}])}),s("el-table-column",{attrs:{label:e.$t("feedbackAtUser"),width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.at_user_id>0?s("el-link",{attrs:{type:"primary",icon:"el-icon-view"},domProps:{textContent:e._s(t.row.at_user_id)},on:{click:function(s){return e.linkUserInfo(t.row.at_user_id)}}}):e._e()]}}])}),s("el-table-column",{attrs:{label:e.$t("feedbackStatus"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("span",{directives:[{name:"t",rawName:"v-t",value:{path:"feedbackStatus"+e.row.status},expression:"{path:`feedbackStatus${scope.row.status}`}"}]})]}}])}),s("el-table-column",{attrs:{label:e.$t("feedbackEmail"),prop:"email",width:"150"}}),s("el-table-column",{attrs:{label:e.$t("feedbackPageUrl"),prop:"page_url",width:"150"}}),s("el-table-column",{attrs:{label:e.$t("content"),prop:"content"}}),s("el-table-column",{attrs:{label:e.$t("createdAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.created_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{fixed:"right",label:e.$t("action"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[s("el-button",{attrs:{title:"查看详细信息",type:"warning",size:"mini"},domProps:{textContent:e._s(e.$t("btnView"))},on:{click:function(s){return e.doView(t.row)}}}),s("el-button",{attrs:{title:"delete a row",type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}})],1)]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("dialog-form-user",{attrs:{obj:e.objUser,type:"view",visible:e.dfvUser,id:e.selectedUserId},on:{afterClose:function(t){e.dfvUser=!1}}}),s("dialog-form-feedback",{attrs:{visible:e.dfvFeedback,obj:e.selectedRow,type:e.dfFeedbackType},on:{afterClose:function(t){e.dfvFeedback=!1}}})],1)},fs=[],bs={components:{DialogFormUser:ee,DialogFormFeedback:oe},name:"ViewFeedback",data(){return{q:{},selectedRow:null,dfFeedbackType:"",selectedUserId:0,objUser:{},dfvUser:!1,dfvFeedback:!1,formTitle:"机器添加",total:0,page:1,size:10,tableData:[],form:{ssh_port:22,cate:2}}},computed:{user(){return this.$store.state.user},email(){return this.$store.getters.userEmail},isAdmin(){return this.$store.getters.userIsAdmin},user_id(){return parseInt(this.$route.query.user_id)||0},machine_id(){return parseInt(this.$route.query.machine_id)||0}},mounted(){this.fetchAllFeedback()},created(){},methods:{linkUserInfo(e){this.objUser={id:e},this.selectedUserId=e,this.dfvUser=!0},doCreate(){this.form={id:0,cate:2,ssh_port:22},this.formTitle=this.$t("machineAddTitle")},pageChange(e){this.page=e,this.fetchAllFeedback()},sizeChange(e){this.page=1,this.size=e,this.fetchAllFeedback()},fetchAllFeedback(){let e=this.q;e.page=this.page,e.size=this.size,this.$http.get("feedback",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doDelete(e){this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.delete(`feedback/${e.id}`).then(e=>{e&&(this.fetchAllFeedback(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},doView(e){this.dfFeedbackType="update",this.dfvFeedback=!0,this.selectedRow=e},doAfterClose(){this.fetchAllFeedback(),this.dfvFeedback=!1}}},gs=bs,ws=Object(n["a"])(gs,ms,fs,!1,null,"83f2ee86",null),vs=ws.exports,_s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),s("el-button",{attrs:{type:"success",size:"small",title:"向当前机器添加SSH用户"},on:{click:function(t){return e.openDialogForm({id:0,ssh_type:"password"},"create")}}},[e._v(e._s(e.$t("btnAdd"))+"\n        ")]),s("div",{staticClass:"search-bar"},[s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("clusterJumperNamePhS"),clearable:""},on:{blur:e.fetchAllClusterJumper},model:{value:e.q.name,callback:function(t){e.$set(e.q,"name",t)},expression:"q.name"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("sshRemarkPhS"),clearable:""},on:{blur:e.fetchAllClusterJumper},model:{value:e.q.remark,callback:function(t){e.$set(e.q,"remark",t)},expression:"q.remark"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("sshUserPhS"),clearable:""},on:{blur:e.fetchAllClusterJumper},model:{value:e.q.ssh_user,callback:function(t){e.$set(e.q,"ssh_user","string"===typeof t?t.trim():t)},expression:"q.ssh_user"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllClusterJumper}})],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"}},[s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{label:e.$t("clusterJumperName"),prop:"name"}}),s("el-table-column",{attrs:{label:e.$t("sshRemark"),prop:"remark"}}),s("el-table-column",{attrs:{label:e.$t("sshUser"),prop:"ssh_user"}}),s("el-table-column",{attrs:{label:e.$t("sshType"),prop:"ssh_type"}}),s("el-table-column",{attrs:{label:e.$t("updatedAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.updated_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{fixed:"right",label:e.$t("action"),width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[s("el-button",{attrs:{title:e.$t("btnEdit"),type:"success",size:"mini"},domProps:{textContent:e._s(e.$t("btnEdit"))},on:{click:function(s){return e.openDialogForm(t.row,"edit")}}}),s("el-button",{attrs:{title:"view detail",type:"warning",size:"mini"},domProps:{textContent:e._s(e.$t("btnView"))},on:{click:function(s){return e.openDialogForm(t.row,"view")}}}),s("el-button",{attrs:{title:"assign machines",type:"primary",size:"mini"},domProps:{textContent:e._s(e.$t("assignMachines"))},on:{click:function(s){return e.assignMachine(t.row)}}}),s("el-button",{attrs:{title:e.$t("btnDelete"),type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}})],1)]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("dialog-form-cluster-jumper",{attrs:{obj:e.form,type:e.dfType,visible:e.dfV,id:0},on:{afterClose:e.doRefresh}}),s("comp-cluster-jumper-bind-machine",{attrs:{obj:e.form,visible:e.compV},on:{afterClose:function(t){e.compV=!1}}})],1)},ys=[],$s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-transfer",{staticClass:"step-form",staticStyle:{display:"flex","justify-content":"space-between"},attrs:{titles:e.titles,filterable:"","filter-method":e.filterMethod,"filter-placeholder":e.$t("searchMachinePh"),data:e.machines},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){e.v=!1}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},ks=[],Ss={props:{obj:{type:Object,require:!0},visible:Boolean},name:"CompClusterJumperBindMachine",data(){return{value:[],titles:["未分配","已绑定"],machines:[],rawUsers:[],filterMethod(e,t){return t.label.indexOf(e)>-1},v:this.visible}},watch:{visible(e){this.v=e}},computed:{dTitle(){return this.$t("clusterJumperBindMachine",this.obj)}},methods:{doOpen(){let e=1,t=9999;this.$http.get("machine",{params:{page:e,size:t}}).then(e=>{if(e){this.rawUsers=e.data;const t=[],s=[],i=this.obj.id;e.data.forEach(e=>{t.push({key:e.id,label:`${e.name}-${e.ssh_ip}`,disabled:!1}),e.cluster_jumper_id===i&&s.push(e.id)}),this.machines=t,this.value=s}})},doOpened(){},handleFormSubmit(){let e=this.obj.id,t=this.value;this.$http.post("cluster-jumper-bind",{cluster_jumper_id:e,machine_ids:t}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})}}},xs=Ss,Cs=(s("2bfa"),Object(n["a"])(xs,$s,ks,!1,null,null,null)),Ps=Cs.exports,As={components:{DialogFormClusterJumper:Ot,CompClusterJumperBindMachine:Ps},name:"ViewClusterJumper",data(){return{q:{remark:"",ssh_user:""},compV:!1,dfType:"",dfV:!1,total:0,page:1,size:10,tableData:[],form:{}}},mounted(){this.fetchAllClusterJumper()},methods:{assignMachine(e){this.form=e,this.compV=!0},doRefresh(){this.dfV=!1,"view"!==this.dfType&&this.fetchAllClusterJumper()},pageChange(e){this.page=e,this.fetchAllClusterJumper()},sizeChange(e){this.page=1,this.size=e,this.fetchAllClusterJumper()},fetchAllClusterJumper(){let e=this.q;e.page=this.page,e.size=this.size,this.$http.get("cluster-jumper",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doDelete(e){this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.delete(`cluster-jumper/${e.id}`).then(e=>{e&&(this.fetchAllClusterJumper(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},openDialogForm(e,t){this.form=e,this.dfType=t,this.dfV=!0}}},Ds=As,zs=Object(n["a"])(Ds,_s,ys,!1,null,"ab2daff0",null),Us=zs.exports,js=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:12}},[s("iframe",{attrs:{src:"http://pan.mojotv.cn:3000/d-solo/cJOZ0cOWk/mojotvFortress?orgId=1&theme=light&panelId=10",frameborder:"0"}})]),s("el-col",{attrs:{span:12}},[s("iframe",{attrs:{src:"http://pan.mojotv.cn:3000/d-solo/cJOZ0cOWk/mojotvFortress?orgId=1&theme=light&panelId=2",frameborder:"0"}})])],1),s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:24}},[s("iframe",{attrs:{src:"http://pan.mojotv.cn:3000/d-solo/cJOZ0cOWk/mojotvFortress?orgId=1&theme=light&panelId=4",frameborder:"0"}})])],1),s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:12}},[s("iframe",{attrs:{src:"http://pan.mojotv.cn:3000/d-solo/cJOZ0cOWk/mojotvFortress?orgId=1&theme=light&panelId=6",frameborder:"0"}})]),s("el-col",{attrs:{span:12}},[s("iframe",{attrs:{src:"http://pan.mojotv.cn:3000/d-solo/cJOZ0cOWk/mojotvFortress?orgId=1&theme=light&panelId=14",frameborder:"0"}})])],1),s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:12}},[s("iframe",{attrs:{src:"http://pan.mojotv.cn:3000/d-solo/cJOZ0cOWk/mojotvFortress?orgId=1&theme=light&panelId=8",frameborder:"0"}})]),s("el-col",{attrs:{span:12}},[s("iframe",{attrs:{src:"http://pan.mojotv.cn:3000/d-solo/cJOZ0cOWk/mojotvFortress?orgId=1&theme=light&panelId=12",frameborder:"0"}})])],1)],1)},Fs=[],Ts={name:"ViewDash"},Ls=Ts,Vs=(s("9b8d"),Object(n["a"])(Ls,js,Fs,!1,null,"32b046b1",null)),Ms=Vs.exports,Is=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),s("el-button",{attrs:{type:"success",size:"small",title:"向当前机器添加SSH用户"},on:{click:function(t){return e.openDialogForm(e.form,"create")}}},[e._v(e._s(e.$t("btnAdd"))+"\n        ")]),s("div",{staticClass:"search-bar"},[s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("filterGroupNamePh"),clearable:""},on:{blur:e.fetchAllfilterGroup},model:{value:e.q.name,callback:function(t){e.$set(e.q,"name",t)},expression:"q.name"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:e.$t("filterGroupRemarkPh"),clearable:""},on:{blur:e.fetchAllfilterGroup},model:{value:e.q.remark,callback:function(t){e.$set(e.q,"remark",t)},expression:"q.remark"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllfilterGroup}})],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"}},[s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{label:e.$t("filterGroupName"),prop:"name"}}),s("el-table-column",{attrs:{label:e.$t("filterGroupRemark"),prop:"remark"}}),s("el-table-column",{attrs:{label:e.$t("updatedAt"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{domProps:{textContent:e._s(t.row.updated_at.substring(2,19))}})]}}])}),s("el-table-column",{attrs:{fixed:"right",label:e.$t("action"),width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[s("el-button",{attrs:{title:e.$t("btnEdit"),type:"success",size:"mini"},domProps:{textContent:e._s(e.$t("btnEdit"))},on:{click:function(s){return e.openDialogForm(t.row,"edit")}}}),s("el-button",{attrs:{title:"view detail",type:"warning",size:"mini"},domProps:{textContent:e._s(e.$t("btnView"))},on:{click:function(s){return e.openDialogForm(t.row,"view")}}}),s("el-button",{attrs:{title:e.$t("btnDelete"),type:"danger",size:"mini"},domProps:{textContent:e._s(e.$t("btnDelete"))},on:{click:function(s){return e.doDelete(t.row)}}})],1)]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("dialog-form-filter-group",{attrs:{obj:e.form,type:e.dfType,visible:e.dfV,id:0},on:{afterClose:e.doRefresh}})],1)},Os=[],qs={components:{DialogFormFilterGroup:Xe},name:"ViewFilterGroup",data(){return{q:{name:"",remark:""},compV:!1,dfType:"",dfV:!1,total:0,page:1,size:10,tableData:[],form:{name:"",remark:"",filters:[]}}},mounted(){this.fetchAllfilterGroup()},methods:{doRefresh(){this.dfV=!1,"view"!==this.dfType&&this.fetchAllfilterGroup()},pageChange(e){this.page=e,this.fetchAllfilterGroup()},sizeChange(e){this.page=1,this.size=e,this.fetchAllfilterGroup()},fetchAllfilterGroup(){let e=this.q;e.page=this.page,e.size=this.size,this.$http.get("filter-group",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},doDelete(e){this.$confirm(this.$t("confirmDeleteMsg"),this.$t("confirmDeleteTitle"),{confirmButtonText:this.$t("ok"),cancelButtonText:this.$t("cancel"),type:"warning"}).then(()=>{this.$http.delete(`filter-group/${e.id}`).then(e=>{e&&(this.fetchAllfilterGroup(),this.$message.success(e.msg))})}).catch(()=>{this.$message({type:"info",message:this.$t("confirmDeleteCancel")})})},openDialogForm(e,t){this.form=e,this.dfType=t,this.dfV=!0}}},Ns=qs,Es=Object(n["a"])(Ns,Is,Os,!1,null,"11e2a516",null),Rs=Es.exports,Bs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",[s("div",{ref:"terminal",staticClass:"hulk-term"}),s("el-dialog",{attrs:{title:"Web SSH Terminal",modal:!1,"close-on-click-modal":!1,width:"40%","show-close":!1,"custom-class":"this-dialog",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[s("el-form",{ref:"form",staticClass:"demo-ruleForm login",attrs:{model:e.form,"label-width":"120px",rules:e.rules}},[s("el-form-item",{attrs:{prop:"addr",label:"Host"}},[s("el-input",{attrs:{"prefix-icon":"el-icon-user-solid",autocomplete:"off",placeholder:"input your ssh addr with port"},model:{value:e.form.addr,callback:function(t){e.$set(e.form,"addr","string"===typeof t?t.trim():t)},expression:"form.addr"}})],1),s("el-form-item",{attrs:{prop:"user",label:"User"}},[s("el-input",{attrs:{"prefix-icon":"el-icon-user-solid",autocomplete:"off",placeholder:"input your ssh user account"},model:{value:e.form.user,callback:function(t){e.$set(e.form,"user","string"===typeof t?t.trim():t)},expression:"form.user"}})],1),s("el-form-item",{attrs:{prop:"password",label:"Password"}},[s("el-input",{attrs:{"prefix-icon":"el-icon-c-scale-to-original",autocomplete:"off",autofocus:!0,"show-password":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.fireWsBindXterm(t)}},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e.zendMode?s("el-form-item",{attrs:{prop:"savePassword",label:""}},[s("el-checkbox",{model:{value:e.form.savePassword,callback:function(t){e.$set(e.form,"savePassword",t)},expression:"form.savePassword"}},[e._v("Remember Password")])],1):e._e()],1),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:e.fireWsBindXterm}},[e._v("Start SSH")])],1)],1)],1)},Hs=[];let Js=(e,t)=>{let s=e=>{t.send(JSON.stringify({type:"resize",rows:e.rows,cols:e.cols}))};e.on("resize",s),t.addEventListener("close",(function(){e.off("resize",s)}))},Gs=(e,t,s,i)=>{e.socket=t;let a=null,r=function(t){i&&i>0?a?a+=t.data:(a=t.data,setTimeout((function(){e.write(a)}),i)):e.write(t.data)},o=function(e){t.send(JSON.stringify({type:"cmd",cmd:lt["Base64"].encode(e)}))};t.onmessage=r,s&&e.on("data",o);let l=setInterval((function(){t.send(JSON.stringify({type:"heartbeat",data:""}))}),2e4);t.addEventListener("close",(function(){t.removeEventListener("message",r),e.off("data",o),delete e.socket,clearInterval(l)}))},Ws={foreground:"#cecece",background:"#1b212f",cursor:"#ffffff",selection:"rgba(255, 255, 255, 0.3)",black:"#000000",brightBlack:"#808080",red:"#ce2f2b",brightRed:"#f44a47",green:"#00b976",brightGreen:"#05d289",yellow:"#e0d500",brightYellow:"#f4f628",magenta:"#bd37bc",brightMagenta:"#d86cd8",blue:"#1d6fca",brightBlue:"#358bed",cyan:"#00a8cf",brightCyan:"#19b8dd",white:"#e5e5e5",brightWhite:"#ffffff"};var Ks={name:"ViewAnyTerm",data(){return{dialogFormVisible:!1,form:{user:"",password:"",savePassword:!1,addr:"127.0.0.1:22"},zendMode:!1,ws:null,term:null,password:"",rules:{user:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}]}}},mounted(){if(this.form.addr=this.$route.query.a||"127.0.0.1:22",this.form.user=this.$route.query.u||"",this.form.password=this.$route.query.p||"",this.$route.query.z)this.zendMode=!1,this.form.savePassword=!1;else{this.zendMode=!0,this.form.savePassword=!0;const e=`${this.form.addr}.${this.form.user}`;this.form.password||(this.form.password=localStorage.getItem(e))}this.dialogFormVisible=!0,this.initXtermCanvas()},beforeDestroy(){this.removeLister()},methods:{onWindowResize(){this.term.fit()},doLink(e,t){"click"===e.type&&window.open(t)},initXtermCanvas(){ye["Terminal"].applyAddon($e),ye["Terminal"].applyAddon(ke),this.term=new ye["Terminal"]({rows:34,fontSize:18,cursorBlink:!0,cursorStyle:"block",bellStyle:"visual",theme:Ws}),this.term.open(this.$refs.terminal),this.term.webLinksInit(this.doLink),this.term.fit(),window.addEventListener("resize",this.onWindowResize)},fireWsBindXterm(){const e=`${this.form.addr}.${this.form.user}`;this.form.savePassword?localStorage.setItem(e,this.form.password):localStorage.removeItem(e),this.term.clear(),this.term.fit();let t=`${ct.wsBase}/api/ws-any-term?cols=${this.term.cols}&rows=${this.term.rows}&a=${this.form.addr}&u=${this.form.user}&p=${this.form.password}`;this.ws=new WebSocket(t),this.ws.onerror=e=>{console.log(e),this.dialogFormVisible=!0,this.$message.error("用户错误")},this.ws.onclose=e=>{console.log(e),this.term.setOption("cursorBlink",!1),1005!==e.code&&(this.dialogFormVisible=!0,this.$notify.error({title:`code ${e.code}`,message:e.reason}),this.removeLister())},this.dialogFormVisible=!1,this.term.focus(),Gs(this.term,this.ws,!0,-1),Js(this.term,this.ws)},removeLister(){window.removeEventListener("resize",this.onWindowResize),this.ws&&this.ws.close(),this.term&&this.term.dispose()}}},Ys=Ks,Zs=(s("3552"),Object(n["a"])(Ys,Bs,Hs,!1,null,"26c75400",null)),Xs=Zs.exports,Qs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"toolbar",attrs:{type:"flex",justify:"start",align:"middle"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(e._s(e.$t("back")))]),s("div",{staticClass:"search-bar"},[s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:"search description",clearable:""},on:{blur:e.fetchAllConfig},model:{value:e.q.remark,callback:function(t){e.$set(e.q,"remark",t)},expression:"q.remark"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:"search key",clearable:""},on:{blur:e.fetchAllConfig},model:{value:e.q.key,callback:function(t){e.$set(e.q,"key","string"===typeof t?t.trim():t)},expression:"q.key"}}),s("el-input",{staticClass:"table-search-input",attrs:{"prefix-icon":"el-icon-search",size:"small",placeholder:"search value",clearable:""},on:{blur:e.fetchAllConfig},model:{value:e.q.value,callback:function(t){e.$set(e.q,"value","string"===typeof t?t.trim():t)},expression:"q.value"}}),s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search",title:e.$t("btnSearch")},on:{click:e.fetchAllConfig}})],1)],1),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:"",size:"mini","cell-class-name":"fortress-cell"}},[s("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:e.$store.state.idWidth}}),s("el-table-column",{attrs:{label:e.$t("configKey"),prop:"key"}}),s("el-table-column",{attrs:{label:e.$t("configValue"),prop:"value"}}),s("el-table-column",{attrs:{label:e.$t("configRemark"),prop:"remark"}}),s("el-table-column",{attrs:{fixed:"right",label:e.$t("action"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button-group",[s("el-button",{attrs:{title:e.$t("btnEdit"),type:"success",size:"mini"},domProps:{textContent:e._s(e.$t("btnEdit"))},on:{click:function(s){return e.openDialogForm(t.row,"edit")}}})],1)]}}])})],1),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,"page-sizes":[10,15,30,45,60],"page-size":e.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.pageChange}}),s("dialog-form-config",{attrs:{obj:e.form,type:e.dfType,visible:e.dfV,id:0},on:{afterClose:e.doRefresh}})],1)},ei=[],ti=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{visible:e.v,title:e.dTitle},on:{"update:visible":function(t){e.v=t},opened:e.doOpened,open:e.doOpen,close:function(t){return e.$emit("afterClose")}}},[s("el-form",{ref:"ruleForm",attrs:{model:e.form,"label-width":e.$store.state.dialogFormLabelWidth,rules:e.rules,"status-icon":""}},[s("el-form-item",{attrs:{label:e.$t("configKey"),prop:"key"}},[s("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:e.form.key,callback:function(t){e.$set(e.form,"key","string"===typeof t?t.trim():t)},expression:"form.key"}})],1),s("el-form-item",{attrs:{label:e.$t("configValue"),prop:"value"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}})],1),s("el-form-item",{attrs:{label:e.$t("configRemark"),prop:"remark"}},[s("el-input",{attrs:{autocomplete:"off",disabled:e.isView},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),e.isView?e._e():s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"cancel"},expression:"{path:'cancel'}"}],on:{click:function(t){return e.$emit("afterClose")}}}),s("el-button",{directives:[{name:"t",rawName:"v-t",value:{path:"submit"},expression:"{path:'submit'}"}],attrs:{type:"primary"},on:{click:e.handleFormSubmit}})],1)],1)},si=[],ii={name:"DialogFormConfig",props:{obj:{type:Object,require:!0},id:{type:Number,require:!0},type:String,visible:Boolean},data(){return{v:this.visible,isView:!1,form:this.obj,rules:{key:[{required:!0,trigger:"blur"}],value:[],remark:[]}}},watch:{visible(e){this.v=e}},computed:{dTitle(){return this.$t("configUpdate")}},methods:{doOpen(){this.form=this.obj,this.isView="view"===this.type,this.isView&&this.id>0&&this.obj&&this.$http.get(`config/${this.id}`).then(e=>{e&&(this.form=e.data)})},postFormData(){let e="post",t="config";"edit"===this.type&&(e="patch"),"create"===this.type&&(e="post");let s=this.form;this.$http({method:e,url:t,data:s}).then(e=>{e&&(this.$message.success("success"),this.v=!1)})},doOpened(){},handleFormSubmit(){this.$refs.ruleForm.validate(e=>{e?this.postFormData():this.$notify.error("表单错误")})}}},ai=ii,ri=Object(n["a"])(ai,ti,si,!1,null,"d2f829b4",null),oi=ri.exports,li={components:{DialogFormConfig:oi},name:"ViewConfig",data(){return{q:{key:"",value:"",remark:""},compV:!1,dfType:"",dfV:!1,total:0,page:1,size:10,tableData:[],form:{}}},mounted(){this.fetchAllConfig()},methods:{doRefresh(){this.dfV=!1,"view"!==this.dfType&&this.fetchAllConfig()},pageChange(e){this.page=e,this.fetchAllConfig()},sizeChange(e){this.page=1,this.size=e,this.fetchAllConfig()},fetchAllConfig(){let e=this.q;e.page=this.page,e.size=this.size,this.$http.get("config",{params:e}).then(e=>{e&&(this.total=e.total,this.size=e.size,this.page=e.page,this.tableData=e.data)})},openDialogForm(e,t){this.form=e,this.dfType=t,this.dfV=!0}}},ni=li,ci=Object(n["a"])(ni,Qs,ei,!1,null,"5e973e3c",null),ui=ci.exports;i["default"].use(h["a"]);const hi=new h["a"]({mode:"hash",routes:[{path:"/any-term",name:"anyTerm",component:Xs},{path:"/login",name:"login",component:T},{path:"/",name:"main",meta:{title:"Home"},component:ue,children:[{path:"sftp/:id/:sshIp/:user",name:"sftp",props:!0,meta:{breads:["main","machine","sftp"]},component:be},{path:"ssh-log",name:"sshLog",meta:{breads:["main","sshLog"]},component:Ie},{path:"dash",name:"dash",meta:{breads:["main","dash"]},component:Ms},{path:"feedback",name:"feedback",meta:{breads:["main","feedback"]},component:vs},{path:"sftp-log",name:"sftpLog",meta:{breads:["main","sftpLog"]},component:ps},{path:"user",name:"user",meta:{breads:["main","user"]},component:st},{path:"machine",name:"machine",meta:{breads:["main","machine"]},component:Rt},{path:"signin-log",name:"signinLog",meta:{breads:["main","signinLog"]},component:ls},{path:"cluster-ssh",name:"clusterSsh",meta:{breads:["main","clusterSsh"]},component:ts},{path:"config",name:"config",meta:{breads:["main","config"]},component:ui},{path:"cluster-jumper",name:"clusterJumper",meta:{breads:["main","clusterJumper"]},component:Us},{path:"filter-group",name:"filterGroup",meta:{breads:["main","filterGroup"]},component:Rs}]}]});var di=hi,pi=s("5c96"),mi=s.n(pi),fi=s("bc3a"),bi=s.n(fi),gi=s("323e"),wi=s.n(gi);const vi=bi.a.create({timeout:3e4,headers:{"Content-Type":"application/json;charset=UTF-8"},baseURL:"/api/"});vi.interceptors.request.use(e=>{if(console.log("欢迎访问后端开发者和前端开发者的技术博客网站: https://mojotv.cn"),wi.a.start(),e.url.includes("login")||e.url.includes("captcha")||e.url.includes("meta"))return e;const t={response:{status:412}};let s=localStorage.getItem("expire_ts");if(s&&parseInt(s)<Date.now()/1e3)return Promise.reject(t);let i=localStorage.getItem("token");return i?(e.headers["Authorization"]="Bearer "+i,e):Promise.reject(t)},e=>{return wi.a.done(),pi["Message"].error("sending request is failed"),Promise.reject(e)}),vi.interceptors.response.use(e=>{wi.a.done();let t=e.data;return t.ok?t:(pi["Message"].warning(t.msg),!1)},e=>{wi.a.done(),e.response&&412===e.response.status?pi["MessageBox"].confirm("token is invalid","jump to login",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{di.push({name:"login"})}):e.response&&200===e.response.status?pi["Message"].warning(e.response.msg):(pi["Message"].error(`http response error code: ${e.response.status}`),console.log(e))});var _i=vi,yi=(s("0fae"),s("a5d8"),s("a925"));const $i={"zh-CN":{remoteControl:"远程登陆",authAdmin:"权限管理",config:"系统配置",configList:"配置列表",admin:"用户管理",adminUser:"用户管理",systemManage:"系统管理",machineList:"机器列表",consolePad:"左:a 上:w 右:d 下:s  A:(i,k)  B:(u,j)  Select:f Start:h",sshTypePassword:"密码",sshTypeKey:"私钥id_rsa",submit:"提交",cancel:"取消",anyTerm:"通用SSH终端",clusterSshCreate:"添加集群管理SSH账号",clusterSshView:"查看集群管理SSH账号",clusterSshUpdate:"更新集群管理SSH账号",clusterSsh:"集群账号",cluster:"集群",machineCreate:"添加机器",machineView:"查看机器",machineUpdate:"更新机器",machineName:"机器名称",machineSshIp:"SSH地址",machineWanIp:"外网IP",machineLanIp:"内网IP",machineCate:"访问类型",machineCateLan:"局域网",machineCateWan:"广域网",machineClusterSsh:"SSH管理账号",machineClusterSshPlace:"请选择SSH管理账号",machineEditTitle:"更新机器信息",machineAddTitle:"添加机器",expiredAtPlaceholder:"请选择账户过期时间",userLogout:"注销",user:"用户",userName:"用户名",sshPassword:"SSH密码",mobile:"手机号",machineCount:"授权机器数量",email:"邮箱",userAdmin:"用户管理",userList:"用户列表",userManage:"用户管理",updatedAt:"更新时间",expiredAt:"过期时间",yes:"是",no:"否",machineControlSshPlaceholder:"请选择root权限管理账号",machineSshPort:"ssh登陆端口",action:"操作",password:"登陆密码",passwordR:"确认密码",sshUser:"SSH用户",sshUserPhS:"搜索SSH用户",sshType:"登陆类型",sshKey:"登陆KEY",sshKeyPassword:"KEY密码",sshRemark:"备注",sshRemarkPhS:"搜索集群ssh账号备注",login:"登陆",loginLdap:"360账号登陆",audit:"安全审计",userUpdateTitle:"更新用户信息",userAddTitle:"创建用户",btnAdd:"创建",btnEdit:"编辑",btnSsh:"SSH",btnSftp:"SFTP",btnView:"查看",btnDelete:"删除",userAncestorPath:"先祖账号",btnMachineUser:"授权用户",btnSshAudit:"SSH审计",btnUserMachines:"授权机器",btnSearch:"查找",rolePlaceholder:"请选择用户类型",userRole:"用户类型",roleAdmin:"管理员",roleUser:"开发",btnTestSsh:"测试SSH连接",back:"返回",realName:"姓名",ldapInfo:"LDAP信息",userBindMachine:"用户: {email} 授权机器",machineBindUser:"机器: {name} 授权用户",clusterSshBindMachine:"集群账号绑定 {ssh_user}-{remark} 绑定机器",machineId:"机器ID",userId:"用户ID",clientIp:"来访IP",startedAt:"开始时间",endAt:"结束时间",auditStatus:"审计状态",logLength:"日志行数",clusterSshBoxTitle:"集群账号({user}) 管理机器列表",remark:"备注",userAgent:"User Agent",createdAt:"创建时间",sftpAction:"SFTP操作",sftpPath:"SFTP路径",next:"下一步",sessionDuration:"会话时长",previous:"上一步",loginType:"登陆方式",assignMachines:"分配机器",main:"首页",machine:"机器",signinLog:"登陆日志",sftpLog:"SFTP日志",feedback:"反馈意见",sshLog:"SSH日志",userRole4:"普通用户",userRole2:"  管理员",updateMyselfInfo:"更新个人信息",addUserAccount:"添加用户账号",viewUserAccount:"查看用户信息",updateUserAccount:"更新用户信息",machineType:"机器类型",fileViewTitle:"SFTP 查看文件内容  {path}",renameOrMove:"重命名或者移动文件",upload:"上传",uploadTip:"上传任意格式文件或者压缩包,使用Shift键选择多个文件,但是操作会被360云平台Fortress记录下来",uploadTitle:"上传文件到 {path} 目录下",feedbackPageUrl:"反馈页面",feedbackUser:"称呼",content:"内容",feedbackAtUser:"@用户",feedbackStatus0:"未处理",feedbackStatus2:"不采纳",feedbackStatus4:"有用",feedbackStatus8:"完成",feedbackStatus16:"Todo",feedbackStatus:"反馈跟踪",feedbackEmail:"联系邮箱",ls:"ls","dl-file":"下载文件","dl-dir":"下载文件夹",cate:"查看文件",rename:"重命名",mkdir:"创建目录","rm-dir":"删除目录","rm-file":"删除文件",ignoreCase:"不区分大小写",hardware:"硬件信息",hi_disk:"磁盘信息",hi_mem:"内存信息",hi_net_card:"网卡信息",hi_cpu:"CPU信息",hi_system:"系统信息",hi_login:"登陆信息",hi_ps:"进程信息",hi_port:"端口信息",loginGithub:"Github登陆",sshFilter:"SSH策略",sshFilterCreate:"添加SSH策略",sshFilterUpdate:"更新SSH策略",sshFilterView:"查看SSH策略",sshFilterCommand:"过滤SSH命令",sshFilterMsg:"提示",sshFilterEnable:"是否开启",sshFilterEnable2:"开启",sshFilterEnable4:"关闭",machineNamePhS:"搜索机器名称",machineSshIpPhS:"搜索机器SSH地址",machineWanIpPhS:"搜索广域网IP",machineLanIpPhS:"搜索局域网IP",sshFilterCommandPhS:"搜索SSH命令",sshFilterMsgPhS:"搜索提示信息",userNamePhS:"搜索用户名",userEmailPhS:"搜索邮箱",userRealNamePhS:"搜索姓名",userMobilePhS:"搜索手机",feedbackPageUrlPhS:"搜索页面地址",feedbackEmailPhS:"搜索邮箱",feedbackUserNamePhS:"搜索用户名",feedbackContentPhS:"搜索内容",last1day:"最近1天",last3day:"最近3天",last7day:"最近天",last1month:"最近1个月",sshLogStartTimePhS:"开始时间",sshLogEndTimePhS:"截至时间",sshLogClientIpPhS:"搜索IP",to:"至",sftpLogPathPhS:"搜索Sftp路径",sftpLogActionPhS:"搜索Sftp操作",userUpdate:"修改信息",siginLogTypePhS:"登陆类型",siginLogEmailPhS:"搜索邮箱",siginLogUserNamePhS:"搜索用户名",siginLogClientIpPhS:"搜索IP",clusterJumper:"私云跳板",clusterJumperCreate:"添加私云跳板代理SSH账号",clusterJumperView:"查看私云跳板代理SSH账号",clusterJumperUpdate:"更新私云跳板代理SSH账号",clusterJumperName:"跳板代理名称",clusterJumperNamePhS:"搜索跳板代理名称",clusterJumperSshAddr:"跳板SSH地址",clusterJumperSshPort:"跳板SSH端口",clusterJumperNone:"无须跳板",sshKeyPhS:"粘贴私钥(~/.ssh/id_rsa)文件内容到这里",searchMachinePh:"搜索机器",searchUserPh:"搜索用户",clusterJumperBindMachine:"私有云跳板代理{name}-{ssh_addr} 关联机器",machineClusterJumper:"集群SSH代理",machineClusterJumperIdPh:"请选择机器跳板代理",owned:"自有",assigned:"分配",confirmDeleteTitle:"提示",confirmDeleteMsg:"此操作将永久删除该行, 是否继续?",confirmDeleteCancel:"已取消删除",ok:"OK",dash:"应用面板",configKey:"配置项",configValue:"配置值",configRemark:"配置说明",filterGroup:"SSH过滤",filterGroupName:"名称",filterGroupRemark:"备注",filterGroupNamePh:"搜索名称",filterGroupRemarkPh:"搜索备注",filterGroupAddRule:"增加规则",filterCommandPh:"需要过滤的SSH命令,支持正则",filterMsgPh:"提示语",filterGroupFilter:"SSH过滤规则",sshFilterPh:"选择一个SSH过滤规则",sshLogStatus32:"Vim",sshLogStatus16:"致命",sshLogStatus8:"危险",sshLogStatus4:"警告",sshLogStatus2:"正常",sshLogStatus0:"未标记",rmSelected:"删除选中"},"en-US":{consolePad:"LEFT:a UP:w RIGHT:d DOWN:s  A:(i,k)  B:(u,j)  Select:f Start:h",sshLogStatus32:"Vim",sshLogStatus16:"Fatal",sshLogStatus8:"Danger",sshLogStatus4:"Warning",sshLogStatus2:"Ok",sshLogStatus0:"Todo",btnSearch:"Find",upload:"Upload",uploadTip:"Upload any file to machine, use Shift key to select multiple files, but your action will be recorded.",uploadTitle:"Upload files to directory of {path}",fileViewTitle:"SFTP Concatenate  {path}",renameOrMove:"Rename Or Move File",remoteControl:"Remote Control",authAdmin:"User Manage",config:"System Config",configList:"Config List",admin:"Staff",adminUser:"User Management",systemManage:"System Management",machineList:"Machines",sshTypePassword:"Password",sshTypeKey:"Private Key id_rsa",submit:"Submit",cancel:"Cancel",userUpdate:"Update User",clusterSsh:"Cluster Account",clusterSshCreate:"Add cluster SSH account",clusterSshView:"View cluster SSH account",clusterSshUpdate:"Update cluster SSH account",cluster:"Cluster",machineName:"Machine Name",machineSshIp:"SSH Address",machineWanIp:"WAN IP",machineLanIp:"LAN IP",machineCate:"Visit Type",machineCateLan:"Local Area Network",machineCateWan:"Wide Area Network",machineClusterSsh:"SSH Account Management",machineClusterSshPlace:"please choose a ssh account",machineEditTitle:"update a machine",machineAddTitle:"Add a machine",expiredAtPlaceholder:"please set a expire time",userLogout:"Logout",user:"User",userName:"User Name",sshPassword:"SSH Password",mobile:"Mobile",machineCount:"Assigned Machine Count",email:"Email",userAdmin:"User Management",userList:"User Account",userManage:"User Management",updatedAt:"Updated At",expiredAt:"Expired At",yes:"Yes",no:"Nope",machineControlSshPlaceholder:"please choose an SSH account of root",machineSshPort:"SSH Port",action:"Action",password:"Password",passwordR:"Confirm Password",sshUser:"SSH User",sshUserPhS:"search cluster ssh by username",sshType:"SSH Type",sshKey:"SSH KEY",sshKeyPassword:"KEY Password",sshRemark:"remark",sshRemarkPhS:"search cluster ssh by remark",login:"Login",loginLdap:"360 Account Login",userUpdateTitle:"Update User",userAddTitle:"Create User",btnAdd:"Create",btnEdit:"Update",btnSsh:"SSH",btnSftp:"SFTP",btnView:"View",btnDelete:"delete",userAncestorPath:"Ancestor Path",btnMachineUser:"Bind User",btnSshAudit:"SSH Audit",btnUserMachines:"Bind machine",rolePlaceholder:"please select a role",userRole:"User Role",roleAdmin:"Admin User",roleUser:"Normal User",back:"Back",realName:"Real Name",ldapInfo:"LDAP Info",userBindMachine:"User: {email} binds machines",machineBindUser:"Machine: {name} binds users",clusterSshBindMachine:"Ssh Account {ssh_user}-{remark} Binds machines",machineId:"Machine ID",userId:"User ID",clientIp:"Client IP",startedAt:"Begin At",endAt:"End At",auditStatus:"Audit Status",logLength:"Line Count",clusterSshBoxTitle:"SSH Account ({user}) Bind to Machines",remark:"Remark",userAgent:"User Agent",createdAt:"Created At",sftpAction:"SFTP Action",sftpPath:"SFTP Path",next:"Next",sessionDuration:"Session Duration",previous:"Previous",loginType:"Login Type",assignMachines:"Assign Machine",audit:"Security Audit",main:"Home",machine:"Machine",machineCreate:"Add machine",machineView:"View machine",machineUpdate:"Update machine",signinLog:"Signin Log",sftpLog:"SFTP Log",feedback:"Feedback",sshLog:"SSH Log",userRole4:"Common User",userRole2:"Admin User",updateMyselfInfo:"Update Myself Information",addUserAccount:"Create a User Account",viewUserAccount:"View a User Information",updateUserAccount:"Update a User Information",machineType:"Machine Type",feedbackPageUrl:"Feedback Page",feedbackUser:"Your Name",content:"Content",feedbackAtUser:"@User",feedbackStatus0:"Unhandled",feedbackStatus2:"Ignore",feedbackStatus4:"Useful",feedbackStatus8:"Done",feedbackStatus16:"Todo",feedbackStatus:"Status",ls:"ls","dl-file":"download file","dl-dir":"download folder",cate:"cate",rename:"rename",mkdir:"mkdir","rm-dir":"rm dir","rm-file":"rm file",ignoreCase:"Ingore Case",hardware:"Hardware",hi_disk:"Disk",hi_mem:"Memory",hi_net_card:"Net card ",hi_cpu:"CPU",hi_system:"System",hi_login:"Login",hi_ps:"Process",hi_port:"Network",loginGithub:"Login Github",sshFilter:"SSH Filter",sshFilterCreate:"Create SSH filter",sshFilterUpdate:"Update SSH filter",sshFilterView:"View SSH filter",sshFilterCommand:"Filter Command",sshFilterMsg:"Display Msg",sshFilterEnable:"Enable Filter",sshFilterEnable2:"Enable",sshFilterEnable4:"Disable",machineNamePhS:"Search machine name",machineSshIpPhS:"Search SSH address",machineWanIpPhS:"Search WAN IP",machineLanIpPhS:"Search LAN IP",sshFilterCommandPhS:"Search command",sshFilterMsgPhS:"Search msg",userNamePhS:"Search user name",userEmailPhS:"Search Email",userRealNamePhS:"Search real name",userMobilePhS:"Search mobile",feedbackPageUrlPhS:"Search page url",feedbackEmailPhS:"Search email",feedbackUserNamePhS:"Search user name",feedbackContentPhS:"Search content",feedbackEmail:"Email",last1day:"Last 1 day",last3day:"Last 3 days",last7day:"Last 7 days",last1month:"Last 1 month",sshLogStartTimePhS:"Start Time",sshLogEndTimePhS:"End Time",sshLogClientIpPhS:"Search Client IP",to:"To",sftpLogPathPhS:"Search path",sftpLogActionPhS:"Search action",siginLogTypePhS:"Login Type",siginLogEmailPhS:"Search Email",siginLogUserNamePhS:"Search user name",siginLogClientIpPhS:"Search IP",clusterJumperCreate:"Add cluster jumper proxy ssh account",clusterJumperView:"View cluster jumper proxy ssh account",clusterJumperUpdate:"Update cluster jumper proxy ssh account",clusterJumper:"PrivateCloud Jumper",clusterJumperName:"Name",clusterJumperNamePhS:"Search jumper name",clusterJumperSshAddr:"Jumper SSH Addr",clusterJumperSshPort:"Jumper SSH Port",clusterJumperNone:"None Proxy",sshKeyPhS:"Paste your private key((~/.ssh/id_rsa) content",searchMachinePh:"Search machine",searchUserPh:"Search user",clusterJumperBindMachine:"Cluster Jumper Proxy {name}-{ssh_addr} assigns machine",machineClusterJumper:"Cluster SSH Proxy",machineClusterJumperIdPh:"select a proxy or none",owned:"Owned",assigned:"Assigned",confirmDeleteTitle:"Warning",confirmDeleteMsg:"This will permanently delete the row. Continue?",confirmDeleteCancel:"Delete canceled",ok:"OK",dash:"Dash",filterGroup:"SSH Filters",filterGroupName:"Name",filterGroupRemark:"Remark",filterGroupNamePh:"Search name",filterGroupRemarkPh:"Search remark",filterGroupAddRule:"Add filter",filterCommandPh:"command need to filter,allow regex",filterGroupFilter:"SSH Filters",filterMsgPh:"hint",sshFilterPh:"select a SSH filter",configKey:"Config Key",configValue:"Config Value",configRemark:"Config Description",rmSelected:"Delete Selected",anyTerm:"Common WebTerm"}};var ki=s("2f62");i["default"].use(ki["a"]);var Si=new ki["a"].Store({state:{dialogFormLabelWidth:"160px",idWidth:120,user:JSON.parse(localStorage.getItem("user"))||{}},mutations:{setUser(e,t){e.user=t,localStorage.setItem("user",JSON.stringify(t))}},getters:{jwt(){return localStorage.getItem("token")||""},userName(e){return e.user.real_name||e.user.name||""},userEmail(e){return e.user.email||""},userIsAdmin(e){return 2===e.user.role||!1},userId(e){return e.user.id||0}}}),xi=s("b2d6"),Ci=s.n(xi);i["default"].use(yi["a"]),i["default"].use(mi.a,{locale:Ci.a}),i["default"].prototype.$http=_i,i["default"].config.productionTip=!1;const Pi=new yi["a"]({locale:"zh-CN",fallbackLocale:"en-US",messages:$i});new i["default"]({router:di,i18n:Pi,store:Si,render:e=>e(u)}).$mount("#app")},"5a93":function(e,t,s){},"5a94":function(e,t,s){"use strict";var i=s("b8b5"),a=s.n(i);a.a},"64a9":function(e,t,s){},"74ee":function(e,t,s){},"7c97":function(e,t,s){},"83ed":function(e,t,s){},"9b8d":function(e,t,s){"use strict";var i=s("7c97"),a=s.n(i);a.a},"9d9d":function(e,t,s){},ad29:function(e,t,s){},b640:function(e,t,s){e.exports=s.p+"img/logo.de804458.jpg"},b7e6:function(e,t,s){"use strict";var i=s("441b"),a=s.n(i);a.a},b8b5:function(e,t,s){},c266:function(e,t,s){"use strict";var i=s("287b"),a=s.n(i);a.a},de75:function(e,t,s){"use strict";var i=s("9d9d"),a=s.n(i);a.a},fe20:function(e,t,s){}});
//# sourceMappingURL=app.9d12785b.js.map